

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="一、gulp 入门简介 gulp 是基于 node 实现Web 前端自动化开发的工具，利用它能够极大的提高开发效率。 在 Web 前端开发工作中有很多“重复工作”，比如压缩CSS&#x2F;JS文件。而这些工作都是有规律的。找到这些规律，并编写 gulp 配置代码,让 gulp 自动执行这些“重复工作”。  将规律转换为 gulp 代码  现有目录结构如下：   12└── js&#x2F;    └── a.js">
<meta property="og:type" content="article">
<meta property="og:title" content="glup总结">
<meta property="og:url" content="http://example.com/2020/09/11/webpack/glup%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="一、gulp 入门简介 gulp 是基于 node 实现Web 前端自动化开发的工具，利用它能够极大的提高开发效率。 在 Web 前端开发工作中有很多“重复工作”，比如压缩CSS&#x2F;JS文件。而这些工作都是有规律的。找到这些规律，并编写 gulp 配置代码,让 gulp 自动执行这些“重复工作”。  将规律转换为 gulp 代码  现有目录结构如下：   12└── js&#x2F;    └── a.js">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cloud.githubusercontent.com/assets/3949015/7137629/a1def1b8-e2ed-11e4-83e0-5a6adb22de6f.png">
<meta property="article:published_time" content="2020-09-11T08:38:48.000Z">
<meta property="article:modified_time" content="2022-06-06T14:44:50.000Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="glup">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cloud.githubusercontent.com/assets/3949015/7137629/a1def1b8-e2ed-11e4-83e0-5a6adb22de6f.png">
  
  
  
  <title>glup总结 - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="glup总结"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2020-09-11 16:38" pubdate>
          September 11, 2020 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          27k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          224 mins
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">glup总结</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="一、gulp-入门简介"><a href="#一、gulp-入门简介" class="headerlink" title="一、gulp 入门简介"></a>一、gulp 入门简介</h2><hr>
<p><code>gulp</code> 是基于 <code>node</code> 实现<code>Web</code> 前端自动化开发的工具，利用它能够极大的提高开发效率。</p>
<p>在 Web 前端开发工作中有很多“重复工作”，比如压缩<code>CSS/JS</code>文件。而这些工作都是有规律的。找到这些规律，并编写 <code>gulp</code> 配置代码,让 <code>gulp</code> 自动执行这些“重复工作”。</p>
<ul>
<li><p>将规律转换为 <code>gulp</code> 代码</p>
</li>
<li><p>现有目录结构如下：</p>
</li>
</ul>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">└── <span class="hljs-keyword">js</span>/<br>    └── a<span class="hljs-number">.</span><span class="hljs-keyword">js</span><br></code></pre></td></tr></table></figure>

<h3 id="1-1-规律"><a href="#1-1-规律" class="headerlink" title="1.1 规律"></a>1.1 规律</h3><hr>
<ul>
<li>找到 <code>js/</code>目录下的所有 .<code>js</code> 文件</li>
<li>压缩这些 <code>js</code> 文件</li>
<li>将压缩后的代码另存在 <code>dist/js/</code> 目录下</li>
</ul>
<h3 id="1-2-编写-gulp-代码"><a href="#1-2-编写-gulp-代码" class="headerlink" title="1.2 编写 gulp 代码"></a>1.2 编写 <code>gulp</code> 代码</h3><hr>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> 压缩 JavaScript 文件<br>gulp.task(<span class="hljs-string">&#x27;script&#x27;</span>, <span class="hljs-keyword">function</span>() &#123;<br>    <span class="hljs-regexp">//</span> <span class="hljs-number">1</span>. 找到<br>    gulp.src(<span class="hljs-string">&#x27;js/*.js&#x27;</span>)<br>    <span class="hljs-regexp">//</span> <span class="hljs-number">2</span>. 压缩<br>        .pipe(uglify())<br>    <span class="hljs-regexp">//</span> <span class="hljs-number">3</span>. 另存<br>        .pipe(gulp.dest(<span class="hljs-string">&#x27;dist/js&#x27;</span>));<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="1-3-代码执行结果"><a href="#1-3-代码执行结果" class="headerlink" title="1.3 代码执行结果"></a>1.3 代码执行结果</h3><hr>
<p>代码执行后文件结构</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">└── <span class="hljs-keyword">js/</span><br><span class="hljs-keyword"></span>│   └── a.<span class="hljs-keyword">js</span><br><span class="hljs-keyword"></span>└── <span class="hljs-keyword">dist/</span><br><span class="hljs-keyword"></span>    └── <span class="hljs-keyword">js/</span><br><span class="hljs-keyword"></span>        └── a.<span class="hljs-keyword">js</span><br></code></pre></td></tr></table></figure>

<p>a.js 压缩前</p>
<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable">function</span> <span class="hljs-variable">demo</span> (<span class="hljs-variable">msg</span>) &#123;<br>    <span class="hljs-function"><span class="hljs-title">alert</span>(<span class="hljs-string">&#x27;--------\r\n&#x27;</span> + <span class="hljs-variable">msg</span> + <span class="hljs-string">&#x27;\r\n--------&#x27;</span>)</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">demo</span>(<span class="hljs-string">&#x27;Hi&#x27;</span>)</span><br></code></pre></td></tr></table></figure>



<p>a.js 压缩后</p>
<figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs wren"><span class="hljs-variable">function</span> <span class="hljs-title function_">demo</span>(<span class="hljs-params">n</span>)&#123;<span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;--------<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>&quot;</span><span class="hljs-operator">+</span><span class="hljs-variable">n</span><span class="hljs-operator">+</span><span class="hljs-string">&quot;<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>--------&quot;</span>)&#125;<span class="hljs-title function_">demo</span>(<span class="hljs-string">&quot;Hi&quot;</span>);<br></code></pre></td></tr></table></figure>



<p>此时 <code>dist/js</code> 目录下的 <code>.js</code> 文件都是压缩后的版本。</p>
<p>你还可以监控 <code>js/</code> 目录下的 js 文件，当某个文件被修改时，自动压缩修改文件。启动 gulp 后就可以让它帮助你自动构建 Web 项目。</p>
<hr>
<p><code>gulp</code> 还可以做很多事，例如：</p>
<ol>
<li>压缩<code>CSS</code></li>
<li>压缩图片</li>
<li>编译<code>Sass/LESS</code></li>
<li>编译<code>CoffeeScript</code></li>
<li><code>markdown</code>转换为 <code>html</code></li>
</ol>
<h2 id="二、安装-Node-和-gulp"><a href="#二、安装-Node-和-gulp" class="headerlink" title="二、安装 Node 和 gulp"></a>二、安装 Node 和 gulp</h2><hr>
<p><code>gulp</code> 是基于 <code>node</code> 实现的，那么我们就需要先安装 node。</p>
<blockquote>
<p>Node 是一个基于Chrome JavaScript V8引擎建立的一个平台，可以利用它实现 Web服务，做类似PHP的事。</p>
</blockquote>
<p>打开 <a target="_blank" rel="noopener" href="https://nodejs.org/">https://nodejs.org/</a> 点击绿色的 <strong>INSTALL</strong> 按钮下载安装 node。</p>
<h3 id="2-1-命令行"><a href="#2-1-命令行" class="headerlink" title="2.1 命令行"></a>2.1 命令行</h3><hr>
<p>在 <code>Windows</code> 中可按 <code>徽标键</code>（alt键左边）+ R 打开输入 <code>cmd</code> + Enter 打开命令行。</p>
<h3 id="2-2-终端-Mac"><a href="#2-2-终端-Mac" class="headerlink" title="2.2 终端(Mac)"></a>2.2 终端(Mac)</h3><hr>
<p>打开 Launchpad（像火箭一样的图标），在屏幕上方搜索框中输入 <code>终端</code> + Enter 打开终端。</p>
<h3 id="2-3-查看-node-版本号"><a href="#2-3-查看-node-版本号" class="headerlink" title="2.3 查看 node 版本号"></a>2.3 查看 node 版本号</h3><hr>
<p>在终端&#x2F;命令行中输入 <code>node -v</code> 检测<code>node</code>是否安装成功，安装成功会显示出<code>node</code> 的版本号。</p>
<h3 id="2-4-跳转目录"><a href="#2-4-跳转目录" class="headerlink" title="2.4 跳转目录"></a>2.4 跳转目录</h3><hr>
<p>终端&#x2F;命令行 中可使用 <code>cd 目录名</code> 跳转至指定目录，Mac 中还可以使用 <code>ls</code> 查看当前目录下的文件列表。</p>
<h3 id="2-5-Windows"><a href="#2-5-Windows" class="headerlink" title="2.5 Windows"></a>2.5 Windows</h3><hr>
<p><code>Windows</code> 下可使用如下命令跳转至指定目录：</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">//</span> 跳转至 C 盘根目录<br><span class="hljs-keyword">cd</span> c:\<br><span class="hljs-string">//</span> 跳转至当前目录的 demo 文件夹<br><span class="hljs-keyword">cd</span> demo<br><span class="hljs-string">//</span> 跳转至上一级<br><span class="hljs-keyword">cd</span> <span class="hljs-string">..</span><br></code></pre></td></tr></table></figure>

<h3 id="2-6-Mac"><a href="#2-6-Mac" class="headerlink" title="2.6 Mac"></a>2.6 Mac</h3><hr>
<p><code>Mac</code>中建议只在 <code>Documents</code>目录下进行文件操作。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> 跳转至文档目录<br>cd <span class="hljs-regexp">/Users/</span>你的用户名<span class="hljs-regexp">/Documents/</span><br><span class="hljs-regexp">//</span> 或第一次打开终端时直接输入<br>cd Documents<br><span class="hljs-regexp">//</span> 查看目录下文件列表<br>ls<br><span class="hljs-regexp">//</span> 创建文件夹<br>mkdir demo<br><span class="hljs-regexp">//</span> 跳转至当前目录下的 demo 文件夹<br>cd demo<br><span class="hljs-regexp">//</span> 跳转至上级目录<br>cd ..<br></code></pre></td></tr></table></figure>

<h3 id="2-7-退出运行状态"><a href="#2-7-退出运行状态" class="headerlink" title="2.7 退出运行状态"></a>2.7 退出运行状态</h3><hr>
<p>如果你在命令行中启动了一些一直运行的命令，你的命令行会进入“运行”状态，此时你不可以在命令行进行其他操作。可通过 <code>Ctrl + C</code> 停止 gulp。（Mac 中使用 <code>control + C</code>）</p>
<p>后面的章节中如果代码中存在 <code>gulp.watch</code> 并在命令行运行了 <code>gulp</code> 则需要使用 <code>Ctrl + C</code> 退出任务。</p>
<h3 id="2-8-npm-模块管理器"><a href="#2-8-npm-模块管理器" class="headerlink" title="2.8 npm 模块管理器"></a>2.8 npm 模块管理器</h3><hr>
<p>如果你了解 <code>npm</code> 则跳过此章节</p>
<p>若你不了解npm 请阅读 <a target="_blank" rel="noopener" href="http://javascript.ruanyifeng.com/nodejs/npm.html">npm模块管理器</a></p>
<h3 id="2-9-安装-gulp"><a href="#2-9-安装-gulp" class="headerlink" title="2.9 安装 gulp"></a>2.9 安装 <code>gulp</code></h3><hr>
<p><code>npm</code> 是 node&#96;&#96; 的包管理工具，可以利用它安装 <code>gulp</code> 所需的包。（在安装 <code>node</code> 时已经自动安装了 <code>npm</code>）</p>
<p>在命令行输入</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">npm <span class="hljs-keyword">install</span> -g gulp<br></code></pre></td></tr></table></figure>

<p>若一直没安装成功，请<a target="_blank" rel="noopener" href="https://github.com/nimojs/blog/issues/20">使用 cnpm 安装</a>(npm的国内加速镜像)</p>
<p>意思是：使用 <code>npm</code> 安装全局性的(<code>-g</code>) gulp 包。</p>
<blockquote>
<p>如果你安装失败，请输入<code>sudo npm install -g gulp</code>使用管理员权限安装。（可能会要求输入密码）</p>
</blockquote>
<p>安装时请注意命令行的提示信息，安装完成后可在命令行输入 <code>gulp -v</code> 以确认安装成功。</p>
<p>至此，我们完成了准备工作。接着让 <code>gulp</code>开始帮我们干活吧！</p>
<h2 id="三、使用-gulp-压缩-JS"><a href="#三、使用-gulp-压缩-JS" class="headerlink" title="三、使用 gulp 压缩 JS"></a>三、使用 gulp 压缩 JS</h2><hr>
<p>压缩<code>js</code> 代码可降低 <code>js</code> 文件大小，提高页面打开速度。在不利用 gulp 时我们需要通过各种工具手动完成压缩工作。</p>
<p>所有的 <code>gulp</code> 代码编写都可以看做是将规律转化为代码的过程。</p>
<ul>
<li><strong>规律</strong></li>
</ul>
<p>找到 <code>js/</code> 目录下的所有<code>js</code> 文件，压缩它们，将压缩后的文件存放在 <code>dist/js/</code> 目录下。</p>
<ul>
<li><code>gulp</code> 代码</li>
</ul>
<p><code>gulp</code> 的所有配置代码都写在 <code>gulpfile.js</code> 文件。</p>
<h3 id="3-1-新建一个-gulpfile-js-文件"><a href="#3-1-新建一个-gulpfile-js-文件" class="headerlink" title="3.1 新建一个 gulpfile.js 文件"></a>3.1 新建一个 <code>gulpfile.js</code> 文件</h3><hr>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">chapter2</span><br>└── gulpfile.js<br></code></pre></td></tr></table></figure>

<h3 id="3-2-在-gulpfile-js-中编写代码"><a href="#3-2-在-gulpfile-js-中编写代码" class="headerlink" title="3.2 在 gulpfile.js 中编写代码"></a>3.2 在 <code>gulpfile.js</code> 中编写代码</h3><hr>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 获取 gulp</span><br><span class="hljs-keyword">var</span> gulp = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;gulp&#x27;</span>)<br></code></pre></td></tr></table></figure>

<blockquote>
<p><code>require()</code> 是 node （CommonJS）中获取模块的语法。</p>
<p>在 gulp 中你只需要理解 <code>require()</code> 可以获取模块。</p>
</blockquote>
<hr>
<h3 id="3-3-获取-gulp-uglify-组件"><a href="#3-3-获取-gulp-uglify-组件" class="headerlink" title="3.3 获取 gulp-uglify 组件"></a>3.3 获取 <code>gulp-uglify</code> 组件</h3><hr>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 获取 uglify 模块（用于压缩 JS）</span><br><span class="hljs-keyword">var</span> uglify = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;gulp-uglify&#x27;</span>)<br></code></pre></td></tr></table></figure>

<hr>
<h3 id="3-4-创建压缩任务"><a href="#3-4-创建压缩任务" class="headerlink" title="3.4 创建压缩任务"></a>3.4 创建压缩任务</h3><hr>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-comment">// 压缩 js 文件</span><br><span class="hljs-comment">// 在命令行使用 gulp script 启动此任务</span><br>gulp<span class="hljs-selector-class">.task</span>(<span class="hljs-string">&#x27;script&#x27;</span>, <span class="hljs-built_in">function</span>() &#123;<br>    <span class="hljs-comment">// 1. 找到文件</span><br>    gulp<span class="hljs-selector-class">.src</span>(<span class="hljs-string">&#x27;js/*.js&#x27;</span>)<br>    <span class="hljs-comment">// 2. 压缩文件</span><br>        <span class="hljs-selector-class">.pipe</span>(<span class="hljs-built_in">uglify</span>())<br>    <span class="hljs-comment">// 3. 另存压缩后的文件</span><br>        <span class="hljs-selector-class">.pipe</span>(gulp<span class="hljs-selector-class">.dest</span>(<span class="hljs-string">&#x27;dist/js&#x27;</span>))<br>&#125;)<br></code></pre></td></tr></table></figure>

<ul>
<li><code>gulp.task(name, fn)</code> - 定义任务，第一个参数是任务名，第二个参数是任务内容。</li>
<li><code>gulp.src(path)</code> - 选择文件，传入参数是文件路径。</li>
<li><code>gulp.dest(path)</code> - 输出文件</li>
<li><code>gulp.pipe()</code> - 管道，你可以暂时将 pipe 理解为将操作加入执行队列</li>
</ul>
<p>参考：<a target="_blank" rel="noopener" href="http://www.gulpjs.com.cn/docs/api/">gulp API文档</a></p>
<hr>
<h3 id="3-5-跳转至-gulpfile-js-所在目录"><a href="#3-5-跳转至-gulpfile-js-所在目录" class="headerlink" title="3.5 跳转至 gulpfile.js 所在目录"></a>3.5 跳转至 <code>gulpfile.js</code> 所在目录</h3><hr>
<p>打开命令行使用 <code>cd</code> 命令跳转至 <code>gulpfile.js</code> 文件所在目录。</p>
<p>例如我的 <code>gulpfile.js</code> 文件保存在 <code>C:\gulp-book\demo\chapter2\gulpfile.js</code>。</p>
<p>那么就需要在命令行输入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> C:\gulp-book\demo\chapter2<br></code></pre></td></tr></table></figure>



<blockquote>
<p>Mac 用户可使用 <code>cd Documents/gulp-book/demo/chapter2/</code> 跳转</p>
</blockquote>
<hr>
<h3 id="3-6-使用命令行运行-script-任务"><a href="#3-6-使用命令行运行-script-任务" class="headerlink" title="3.6 使用命令行运行 script 任务"></a>3.6 使用命令行运行 script 任务</h3><hr>
<p>在控制台输入 <code>gulp 任务名</code> 可运行任务，此处我们输入 <code>gulp script</code> 回车。</p>
<p>注意：输入 <code>gulp script</code> 后命令行将会提示错误信息</p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs subunit">// 在命令行输入<br>gulp script<br><br><span class="hljs-keyword">Error: </span>Cannot find module &#x27;gulp-uglify&#x27;<br>    at Function.Module._resolveFilename (module.js:338:15)<br>    at Function.Module._load (module.js:280:25)<br></code></pre></td></tr></table></figure>



<p><code>Cannot find module &#39;gulp-uglify&#39;</code> 没有找到 <code>gulp-uglify</code> 模块。</p>
<hr>
<h3 id="3-7-安装-gulp-uglify-模块"><a href="#3-7-安装-gulp-uglify-模块" class="headerlink" title="3.7 安装 gulp-uglify 模块"></a>3.7 安装 <code>gulp-uglify</code> 模块</h3><hr>
<p>因为我们并没有安装 <code>gulp-uglify</code> 模块到本地，所以找不到此模块。</p>
<p>使用 npm 安装 <code>gulp-uglify</code> 到本地</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">npm <span class="hljs-keyword">install</span> gulp-uglify<br></code></pre></td></tr></table></figure>

<p>安装成功后你会看到如下信息：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">gulp-<span class="hljs-symbol">uglify@</span><span class="hljs-number">1.1</span><span class="hljs-number">.0</span> node_modules/gulp-uglify<br>├── <span class="hljs-symbol">deepmerge@</span><span class="hljs-number">0.2</span><span class="hljs-number">.7</span><br>├── uglify-<span class="hljs-symbol">js@</span><span class="hljs-number">2.4</span><span class="hljs-number">.16</span> (uglify-to-<span class="hljs-symbol">browserify@</span><span class="hljs-number">1.0</span><span class="hljs-number">.2</span>, <span class="hljs-symbol">async@</span><span class="hljs-number">0.2</span><span class="hljs-number">.10</span>, source-<span class="hljs-symbol">map@</span><span class="hljs-number">0.1</span><span class="hljs-number">.34</span>, <span class="hljs-symbol">optimist@</span><span class="hljs-number">0.3</span><span class="hljs-number">.7</span>)<br>├── vinyl-sourcemaps-<span class="hljs-symbol">apply@</span><span class="hljs-number">0.1</span><span class="hljs-number">.4</span> (source-<span class="hljs-symbol">map@</span><span class="hljs-number">0.1</span><span class="hljs-number">.43</span>)<br>├── <span class="hljs-symbol">through2@</span><span class="hljs-number">0.6</span><span class="hljs-number">.3</span> (<span class="hljs-symbol">xtend@</span><span class="hljs-number">4.0</span><span class="hljs-number">.0</span>, readable-<span class="hljs-symbol">stream@</span><span class="hljs-number">1.0</span><span class="hljs-number">.33</span>)<br>└── gulp-<span class="hljs-symbol">util@</span><span class="hljs-number">3.0</span><span class="hljs-number">.4</span> (<span class="hljs-built_in">array</span>-<span class="hljs-symbol">differ@</span><span class="hljs-number">1.0</span><span class="hljs-number">.0</span>, <span class="hljs-symbol">beeper@</span><span class="hljs-number">1.0</span><span class="hljs-number">.0</span>, <span class="hljs-built_in">array</span>-<span class="hljs-symbol">uniq@</span><span class="hljs-number">1.0</span><span class="hljs-number">.2</span>, object-<span class="hljs-symbol">assign@</span><span class="hljs-number">2.0</span><span class="hljs-number">.0</span>, lodash.<span class="hljs-symbol">_reinterpolate@</span><span class="hljs-number">3.0</span><span class="hljs-number">.0</span>, lodash.<span class="hljs-symbol">_reescape@</span><span class="hljs-number">3.0</span><span class="hljs-number">.0</span>, lodash.<span class="hljs-symbol">_reevaluate@</span><span class="hljs-number">3.0</span><span class="hljs-number">.0</span>, replace-<span class="hljs-symbol">ext@</span><span class="hljs-number">0.0</span><span class="hljs-number">.1</span>, <span class="hljs-symbol">minimist@</span><span class="hljs-number">1.1</span><span class="hljs-number">.1</span>, <span class="hljs-symbol">chalk@</span><span class="hljs-number">1.0</span><span class="hljs-number">.0</span>, lodash.<span class="hljs-symbol">template@</span><span class="hljs-number">3.3</span><span class="hljs-number">.2</span>, <span class="hljs-symbol">vinyl@</span><span class="hljs-number">0.4</span><span class="hljs-number">.6</span>, <span class="hljs-symbol">multipipe@</span><span class="hljs-number">0.1</span><span class="hljs-number">.2</span>, <span class="hljs-symbol">dateformat@</span><span class="hljs-number">1.0</span><span class="hljs-number">.11</span>)<br>chapter2 $<br></code></pre></td></tr></table></figure>



<p>在你的文件夹中会新增一个 <code>node_modules</code> 文件夹，这里面存放着 npm 安装的模块。</p>
<p>目录结构：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">├── gulpfile.<span class="hljs-keyword">js</span><br><span class="hljs-keyword"></span>└── node_modules<br>	└── gulp-uglify<br></code></pre></td></tr></table></figure>



<p>接着输入 <code>gulp script</code> 执行任务</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">gulp script<br>[<span class="hljs-number">13</span>:<span class="hljs-number">34</span>:<span class="hljs-number">57</span>] Using gulpfile ~<span class="hljs-regexp">/Documents/</span>code<span class="hljs-regexp">/gulp-book/</span>demo<span class="hljs-regexp">/chapter2/gu</span>lpfile.js<br>[<span class="hljs-number">13</span>:<span class="hljs-number">34</span>:<span class="hljs-number">57</span>] Starting <span class="hljs-string">&#x27;script&#x27;</span>...<br>[<span class="hljs-number">13</span>:<span class="hljs-number">34</span>:<span class="hljs-number">57</span>] Finished <span class="hljs-string">&#x27;script&#x27;</span> after <span class="hljs-number">6.13</span> ms<br></code></pre></td></tr></table></figure>

<hr>
<h3 id="3-8-编写-js-文件"><a href="#3-8-编写-js-文件" class="headerlink" title="3.8 编写 js 文件"></a>3.8 编写 js 文件</h3><hr>
<p>我们发现 gulp 没有进行任何压缩操作。因为没有js这个目录，也没有 js 目录下的 <code>.js</code> 后缀文件。</p>
<p>创建 <code>a.js</code> 文件，并编写如下内容</p>
<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-comment">// a.js</span><br><span class="hljs-variable">function</span> <span class="hljs-variable">demo</span> (<span class="hljs-variable">msg</span>) &#123;<br>    <span class="hljs-function"><span class="hljs-title">alert</span>(<span class="hljs-string">&#x27;--------\r\n&#x27;</span> + <span class="hljs-variable">msg</span> + <span class="hljs-string">&#x27;\r\n--------&#x27;</span>)</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">demo</span>(<span class="hljs-string">&#x27;Hi&#x27;</span>)</span><br></code></pre></td></tr></table></figure>

<p>目录结构：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">├── gulpfile.<span class="hljs-keyword">js</span><br><span class="hljs-keyword"></span>├──  <span class="hljs-keyword">js</span><br><span class="hljs-keyword"></span>│	└── a.<span class="hljs-keyword">js</span><br><span class="hljs-keyword"></span>└── node_modules<br>	└── gulp-uglify<br></code></pre></td></tr></table></figure>



<p>接着在命令行输入 <code>gulp script</code> 执行任务</p>
<p>gulp 会在命令行当前目录下创建 <code>dist/js/</code> 文件夹，并创建压缩后的 <code>a.js</code> 文件。</p>
<p>目录结构：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">├── gulpfile.<span class="hljs-keyword">js</span><br><span class="hljs-keyword"></span>├──  <span class="hljs-keyword">js</span><br><span class="hljs-keyword"></span>│	└── a.<span class="hljs-keyword">js</span><br><span class="hljs-keyword"></span>├──  <span class="hljs-keyword">dist</span><br><span class="hljs-keyword"></span>│	└── <span class="hljs-keyword">js</span><br><span class="hljs-keyword"></span>│		└── a.<span class="hljs-keyword">js</span><br><span class="hljs-keyword"></span>└── node_modules<br>	└── gulp-uglify<br></code></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://github.com/nimojs/gulp-book/blob/master/demo/chapter2/dist/js/a.js">dist&#x2F;js&#x2F;a.js</a></p>
<figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs wren"><span class="hljs-variable">function</span> <span class="hljs-title function_">demo</span>(<span class="hljs-params">n</span>)&#123;<span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;--------<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>&quot;</span><span class="hljs-operator">+</span><span class="hljs-variable">n</span><span class="hljs-operator">+</span><span class="hljs-string">&quot;<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>--------&quot;</span>)&#125;<span class="hljs-title function_">demo</span>(<span class="hljs-string">&quot;Hi&quot;</span>);<br></code></pre></td></tr></table></figure>



<hr>
<h3 id="3-9-检测代码修改自动执行任务"><a href="#3-9-检测代码修改自动执行任务" class="headerlink" title="3.9 检测代码修改自动执行任务"></a>3.9 检测代码修改自动执行任务</h3><hr>
<p><code>js/a.js</code>一旦有修改 就必须重新在命令行输入 <code>gulp script</code> ，这很麻烦。</p>
<p>可以使用 <code>gulp.watch(src, fn)</code> 检测指定目录下文件的修改后执行任务。</p>
<p>在 <code>gulpfile.js</code> 中编写如下代码：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> 监听文件修改，当文件被修改则执行 script 任务<br>gulp.watch(<span class="hljs-string">&#x27;js/*.js&#x27;</span>, [<span class="hljs-string">&#x27;script&#x27;</span>]);<br></code></pre></td></tr></table></figure>



<p>但是没有命令可以运行 <code>gulp.watch()</code>，需要将 <code>gulp.watch()</code> 包含在一个任务中。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> 在命令行使用 gulp auto 启动此任务<br>gulp.task(<span class="hljs-string">&#x27;auto&#x27;</span>, <span class="hljs-keyword">function</span> () &#123;<br>    <span class="hljs-regexp">//</span> 监听文件修改，当文件被修改则执行 script 任务<br>    gulp.watch(<span class="hljs-string">&#x27;js/*.js&#x27;</span>, [<span class="hljs-string">&#x27;script&#x27;</span>])<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>接着在命令行输入 <code>gulp auto</code>，自动监听 <code>js/*.js</code> 文件的修改后压缩js。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-variable">$gulp</span> auto<br>[<span class="hljs-number">21</span>:<span class="hljs-number">09</span>:<span class="hljs-number">45</span>] Using gulpfile ~<span class="hljs-regexp">/Documents/</span>code<span class="hljs-regexp">/gulp-book/</span>demo<span class="hljs-regexp">/chapter2/gu</span>lpfile.js<br>[<span class="hljs-number">21</span>:<span class="hljs-number">09</span>:<span class="hljs-number">45</span>] Starting <span class="hljs-string">&#x27;auto&#x27;</span>...<br>[<span class="hljs-number">21</span>:<span class="hljs-number">09</span>:<span class="hljs-number">45</span>] Finished <span class="hljs-string">&#x27;auto&#x27;</span> after <span class="hljs-number">9.19</span> ms<br></code></pre></td></tr></table></figure>

<p>此时修改 <code>js/a.js</code> 中的代码并保存。命令行将会出现提示，表示检测到文件修改并压缩文件。</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs prolog">[<span class="hljs-number">21</span>:<span class="hljs-number">11</span>:<span class="hljs-number">01</span>] <span class="hljs-symbol">Starting</span> <span class="hljs-string">&#x27;script&#x27;</span>...<br>[<span class="hljs-number">21</span>:<span class="hljs-number">11</span>:<span class="hljs-number">01</span>] <span class="hljs-symbol">Finished</span> <span class="hljs-string">&#x27;script&#x27;</span> after <span class="hljs-number">2.85</span> ms<br></code></pre></td></tr></table></figure>

<p>至此，我们完成了 gulp 压缩 js 文件的自动化代码编写。</p>
<p><strong>注意：</strong>使用 <code>gulp.watch</code> 后你的命令行会进入“运行”状态，此时你不可以在命令行进行其他操作。可通过 <code>Ctrl + C</code> 停止 gulp。</p>
<blockquote>
<p>Mac 下使用 <code>control + C</code> 停止 gulp</p>
</blockquote>
<h3 id="3-10-使用-gulp-task-‘default’-fn-定义默认任务"><a href="#3-10-使用-gulp-task-‘default’-fn-定义默认任务" class="headerlink" title="3.10 使用 gulp.task(‘default’, fn) 定义默认任务"></a>3.10 使用 gulp.task(‘default’, fn) 定义默认任务</h3><hr>
<p>增加如下代码</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">gulp.<span class="hljs-keyword">task</span>(<span class="hljs-symbol">&#x27;default</span>&#x27;, [<span class="hljs-symbol">&#x27;script</span>&#x27;, <span class="hljs-symbol">&#x27;auto</span>&#x27;]);<br></code></pre></td></tr></table></figure>

<p>此时你可以在命令行直接输入 <code>gulp</code> +回车，运行 <code>script</code> 和 <code>auto</code> 任务。</p>
<p>最终代码如下：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-comment">// 获取 gulp</span><br><span class="hljs-selector-tag">var</span> gulp = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;gulp&#x27;</span>)<br><br><span class="hljs-comment">// 获取 uglify 模块（用于压缩 JS）</span><br><span class="hljs-selector-tag">var</span> uglify = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;gulp-uglify&#x27;</span>)<br><br><span class="hljs-comment">// 压缩 js 文件</span><br><span class="hljs-comment">// 在命令行使用 gulp script 启动此任务</span><br>gulp<span class="hljs-selector-class">.task</span>(<span class="hljs-string">&#x27;script&#x27;</span>, <span class="hljs-built_in">function</span>() &#123;<br>    <span class="hljs-comment">// 1. 找到文件</span><br>    gulp<span class="hljs-selector-class">.src</span>(<span class="hljs-string">&#x27;js/*.js&#x27;</span>)<br>    <span class="hljs-comment">// 2. 压缩文件</span><br>        <span class="hljs-selector-class">.pipe</span>(<span class="hljs-built_in">uglify</span>())<br>    <span class="hljs-comment">// 3. 另存压缩后的文件</span><br>        <span class="hljs-selector-class">.pipe</span>(gulp<span class="hljs-selector-class">.dest</span>(<span class="hljs-string">&#x27;dist/js&#x27;</span>))<br>&#125;)<br><br><span class="hljs-comment">// 在命令行使用 gulp auto 启动此任务</span><br>gulp<span class="hljs-selector-class">.task</span>(<span class="hljs-string">&#x27;auto&#x27;</span>, function () &#123;<br>    <span class="hljs-comment">// 监听文件修改，当文件被修改则执行 script 任务</span><br>    gulp<span class="hljs-selector-class">.watch</span>(<span class="hljs-string">&#x27;js/*.js&#x27;</span>, <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;script&#x27;</span>]</span>)<br>&#125;)<br><br><br><span class="hljs-comment">// 使用 gulp.task(&#x27;default&#x27;) 定义默认任务</span><br><span class="hljs-comment">// 在命令行使用 gulp 启动 script 任务和 auto 任务</span><br>gulp<span class="hljs-selector-class">.task</span>(<span class="hljs-string">&#x27;default&#x27;</span>, <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;script&#x27;</span>, <span class="hljs-string">&#x27;auto&#x27;</span>]</span>)<br></code></pre></td></tr></table></figure>

<p>去除注释后，你会发现只需要 11 行代码就可以让 gulp 自动监听 js 文件的修改后压缩代码。但是还有还有一些性能问题和缺少容错性，将在后面的章节详细说明。</p>
<p>你可以访问 <a target="_blank" rel="noopener" href="https://github.com/terinjokes/gulp-uglify">gulp-uglify</a> 以查看更多用法。</p>
<h2 id="四、使用-gulp-压缩-CSS"><a href="#四、使用-gulp-压缩-CSS" class="headerlink" title="四、使用 gulp 压缩 CSS"></a>四、使用 gulp 压缩 CSS</h2><hr>
<p>压缩 css 代码可降低 css 文件大小，提高页面打开速度。</p>
<p>我们接着将规律转换为 gulp 代码</p>
<ul>
<li><strong>规律</strong></li>
</ul>
<p>找到 <code>css/</code> 目录下的所有 css 文件，压缩它们，将压缩后的文件存放在 <code>dist/css/</code> 目录下。</p>
<h3 id="4-1-安装-gulp-minify-css模块"><a href="#4-1-安装-gulp-minify-css模块" class="headerlink" title="4.1 安装 gulp-minify-css模块"></a>4.1 安装 gulp-minify-css模块</h3><hr>
<p>提示：你需要使用命令行的 <code>cd</code> 切换到对应目录后进行安装操作。</p>
<p>在命令行输入</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">npm <span class="hljs-keyword">install</span> gulp-minify-css<br></code></pre></td></tr></table></figure>

<p>安装成功后你会看到如下信息：(安装时间可能会比较长)</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">gulp-minify-css</span>@<span class="hljs-number">1.0</span><span class="hljs-selector-class">.0</span> <span class="hljs-selector-tag">node_modules</span>/<span class="hljs-selector-tag">gulp-minify-css</span><br>├── <span class="hljs-selector-tag">object</span><span class="hljs-selector-tag">-assign</span>@<span class="hljs-number">2.0</span><span class="hljs-selector-class">.0</span><br>├── <span class="hljs-selector-tag">vinyl-sourcemaps-apply</span>@<span class="hljs-number">0.1</span><span class="hljs-selector-class">.4</span> (source-map<span class="hljs-variable">@0</span>.<span class="hljs-number">1.43</span>)<br>├── <span class="hljs-selector-tag">clean-css</span>@<span class="hljs-number">3.1</span><span class="hljs-selector-class">.8</span> (commander<span class="hljs-variable">@2</span>.<span class="hljs-number">6.0</span>, source-map<span class="hljs-variable">@0</span>.<span class="hljs-number">1.43</span>)<br>├── <span class="hljs-selector-tag">through2</span>@<span class="hljs-number">0.6</span><span class="hljs-selector-class">.3</span> (xtend<span class="hljs-variable">@4</span>.<span class="hljs-number">0.0</span>, readable-stream<span class="hljs-variable">@1</span>.<span class="hljs-number">0.33</span>)<br>├── <span class="hljs-selector-tag">vinyl-bufferstream</span>@<span class="hljs-number">1.0</span><span class="hljs-selector-class">.1</span> (bufferstreams<span class="hljs-variable">@1</span>.<span class="hljs-number">0.1</span>)<br>└── <span class="hljs-selector-tag">gulp-util</span>@<span class="hljs-number">3.0</span><span class="hljs-selector-class">.4</span> (array-differ<span class="hljs-variable">@1</span>.<span class="hljs-number">0.0</span>, beeper<span class="hljs-variable">@1</span>.<span class="hljs-number">0.0</span>, array-uniq<span class="hljs-variable">@1</span>.<span class="hljs-number">0.2</span>, lodash._reescape<span class="hljs-variable">@3</span>.<span class="hljs-number">0.0</span>, lodash._reinterpolate<span class="hljs-variable">@3</span>.<span class="hljs-number">0.0</span>, lodash._reevaluate<span class="hljs-variable">@3</span>.<span class="hljs-number">0.0</span>, replace-ext<span class="hljs-variable">@0</span>.<span class="hljs-number">0.1</span>, minimist<span class="hljs-variable">@1</span>.<span class="hljs-number">1.1</span>, multipipe<span class="hljs-variable">@0</span>.<span class="hljs-number">1.2</span>, vinyl<span class="hljs-variable">@0</span>.<span class="hljs-number">4.6</span>, chalk<span class="hljs-variable">@1</span>.<span class="hljs-number">0.0</span>, lodash.template<span class="hljs-variable">@3</span>.<span class="hljs-number">3.2</span>, dateformat<span class="hljs-variable">@1</span>.<span class="hljs-number">0.11</span>)<br></code></pre></td></tr></table></figure>

<h3 id="4-2-参照-使用-gulp-压缩-JS-创建-gulpfile-js-文件编写代码"><a href="#4-2-参照-使用-gulp-压缩-JS-创建-gulpfile-js-文件编写代码" class="headerlink" title="4.2 参照 [使用 gulp 压缩 JS]创建 gulpfile.js 文件编写代码"></a>4.2 参照 [使用 gulp 压缩 JS]创建 <code>gulpfile.js</code> 文件编写代码</h3><hr>
<p>在对应目录创建 <code>gulpfile.js</code> 文件并写入如下内容：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> 获取 gulp<br>var gulp = require(<span class="hljs-string">&#x27;gulp&#x27;</span>)<br><br><span class="hljs-regexp">//</span> 获取 minify-css 模块（用于压缩 CSS）<br>var minifyCSS = require(<span class="hljs-string">&#x27;gulp-minify-css&#x27;</span>)<br><br><span class="hljs-regexp">//</span> 压缩 css 文件<br><span class="hljs-regexp">//</span> 在命令行使用 gulp css 启动此任务<br>gulp.task(<span class="hljs-string">&#x27;css&#x27;</span>, <span class="hljs-keyword">function</span> () &#123;<br>    <span class="hljs-regexp">//</span> <span class="hljs-number">1</span>. 找到文件<br>    gulp.src(<span class="hljs-string">&#x27;css/*.css&#x27;</span>)<br>    <span class="hljs-regexp">//</span> <span class="hljs-number">2</span>. 压缩文件<br>        .pipe(minifyCSS())<br>    <span class="hljs-regexp">//</span> <span class="hljs-number">3</span>. 另存为压缩文件<br>        .pipe(gulp.dest(<span class="hljs-string">&#x27;dist/css&#x27;</span>))<br>&#125;)<br><br><span class="hljs-regexp">//</span> 在命令行使用 gulp auto 启动此任务<br>gulp.task(<span class="hljs-string">&#x27;auto&#x27;</span>, <span class="hljs-keyword">function</span> () &#123;<br>    <span class="hljs-regexp">//</span> 监听文件修改，当文件被修改则执行 css 任务<br>    gulp.watch(<span class="hljs-string">&#x27;css/*.css&#x27;</span>, [<span class="hljs-string">&#x27;css&#x27;</span>])<br>&#125;);<br><br><span class="hljs-regexp">//</span> 使用 gulp.task(<span class="hljs-string">&#x27;default&#x27;</span>) 定义默认任务<br><span class="hljs-regexp">//</span> 在命令行使用 gulp 启动 css 任务和 auto 任务<br>gulp.task(<span class="hljs-string">&#x27;default&#x27;</span>, [<span class="hljs-string">&#x27;css&#x27;</span>, <span class="hljs-string">&#x27;auto&#x27;</span>])<br></code></pre></td></tr></table></figure>

<p>你可以访问 <a target="_blank" rel="noopener" href="https://github.com/jonathanepollack/gulp-minify-css">gulp-minify-css</a> 以查看更多用法。</p>
<hr>
<h3 id="4-3-创建-css-文件"><a href="#4-3-创建-css-文件" class="headerlink" title="4.3 创建 css 文件"></a>4.3 创建 css 文件</h3><hr>
<p>在 <code>gulpfile.js</code> 对应目录创建 <code>css</code> 文件夹，并在 <code>css/</code> 目录下创建 <code>a.css</code> 文件。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-comment">/* a.css */</span><br><span class="hljs-selector-tag">body</span> <span class="hljs-selector-tag">a</span>&#123;<br>    <span class="hljs-attribute">color</span>:pink;<br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<h3 id="4-4-运行-gulp-查看效果"><a href="#4-4-运行-gulp-查看效果" class="headerlink" title="4.4 运行 gulp 查看效果"></a>4.4 运行 gulp 查看效果</h3><hr>
<p>在命令行输入 <code>gulp</code> +回车</p>
<p>你将看到命令行出现如下提示</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs prolog">gulp<br>[<span class="hljs-number">17</span>:<span class="hljs-number">01</span>:<span class="hljs-number">19</span>] <span class="hljs-symbol">Using</span> gulpfile ~/<span class="hljs-symbol">Documents</span>/code/gulp-book/demo/chapter3/gulpfile.js<br>[<span class="hljs-number">17</span>:<span class="hljs-number">01</span>:<span class="hljs-number">19</span>] <span class="hljs-symbol">Starting</span> <span class="hljs-string">&#x27;css&#x27;</span>...<br>[<span class="hljs-number">17</span>:<span class="hljs-number">01</span>:<span class="hljs-number">19</span>] <span class="hljs-symbol">Finished</span> <span class="hljs-string">&#x27;css&#x27;</span> after <span class="hljs-number">6.21</span> ms<br>[<span class="hljs-number">17</span>:<span class="hljs-number">01</span>:<span class="hljs-number">19</span>] <span class="hljs-symbol">Starting</span> <span class="hljs-string">&#x27;auto&#x27;</span>...<br>[<span class="hljs-number">17</span>:<span class="hljs-number">01</span>:<span class="hljs-number">19</span>] <span class="hljs-symbol">Finished</span> <span class="hljs-string">&#x27;auto&#x27;</span> after <span class="hljs-number">5.42</span> ms<br>[<span class="hljs-number">17</span>:<span class="hljs-number">01</span>:<span class="hljs-number">19</span>] <span class="hljs-symbol">Starting</span> <span class="hljs-string">&#x27;default&#x27;</span>...<br>[<span class="hljs-number">17</span>:<span class="hljs-number">01</span>:<span class="hljs-number">19</span>] <span class="hljs-symbol">Finished</span> <span class="hljs-string">&#x27;default&#x27;</span> after <span class="hljs-number">5.71</span> μs<br></code></pre></td></tr></table></figure>

<p>gulp 会创建 <code>dist/css</code> 目录，并创建 <code>a.css</code> 文件，此文件存放压缩后的 css 代码。<br><a target="_blank" rel="noopener" href="https://github.com/nimojs/gulp-book/blob/master/demo/chapter3/dist/css/a.css">dist&#x2F;css&#x2F;a.css</a></p>
<h2 id="五、使用-gulp-压缩图片"><a href="#五、使用-gulp-压缩图片" class="headerlink" title="五、使用 gulp 压缩图片"></a>五、使用 gulp 压缩图片</h2><hr>
<p>压缩 图片文件可降低文件大小，提高图片加载速度。</p>
<p>找到规律转换为 gulp 代码</p>
<ul>
<li><strong>规律</strong></li>
</ul>
<p>找到 <code>images/</code> 目录下的所有文件，压缩它们，将压缩后的文件存放在 <code>dist/images/</code> 目录下。</p>
<h3 id="5-1-安装-gulp-imagemin-模块"><a href="#5-1-安装-gulp-imagemin-模块" class="headerlink" title="5.1 安装 gulp-imagemin 模块"></a>5.1 安装 gulp-imagemin 模块</h3><hr>
<p>提示：你需要使用命令行的 <code>cd</code> 切换至对应目录再进行安装操作和 gulp 启动操作。</p>
<p>在命令行输入</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">npm <span class="hljs-keyword">install</span> gulp-imagemin<br></code></pre></td></tr></table></figure>

<p>安装成功后你会看到如下信息：(安装时间可能会比较长)</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">gulp-imagemin</span>@<span class="hljs-number">2.2</span><span class="hljs-selector-class">.1</span> <span class="hljs-selector-tag">node_modules</span>/<span class="hljs-selector-tag">gulp-imagemin</span><br>├── <span class="hljs-selector-tag">object</span><span class="hljs-selector-tag">-assign</span>@<span class="hljs-number">2.0</span><span class="hljs-selector-class">.0</span><br>├── <span class="hljs-selector-tag">pretty-bytes</span>@<span class="hljs-number">1.0</span><span class="hljs-selector-class">.3</span> (get-stdin<span class="hljs-variable">@4</span>.<span class="hljs-number">0.1</span>)<br>├── <span class="hljs-selector-tag">chalk</span>@<span class="hljs-number">1.0</span><span class="hljs-selector-class">.0</span> (escape-string-regexp<span class="hljs-variable">@1</span>.<span class="hljs-number">0.3</span>, ansi-styles<span class="hljs-variable">@2</span>.<span class="hljs-number">0.1</span>, supports-color<span class="hljs-variable">@1</span>.<span class="hljs-number">3.1</span>, has-ansi<span class="hljs-variable">@1</span>.<span class="hljs-number">0.3</span>, strip-ansi<span class="hljs-variable">@2</span>.<span class="hljs-number">0.1</span>)<br>├── <span class="hljs-selector-tag">through2-concurrent</span>@<span class="hljs-number">0.3</span><span class="hljs-selector-class">.1</span> (through2<span class="hljs-variable">@0</span>.<span class="hljs-number">6.3</span>)<br>├── <span class="hljs-selector-tag">gulp-util</span>@<span class="hljs-number">3.0</span><span class="hljs-selector-class">.4</span> (array-differ<span class="hljs-variable">@1</span>.<span class="hljs-number">0.0</span>, beeper<span class="hljs-variable">@1</span>.<span class="hljs-number">0.0</span>, array-uniq<span class="hljs-variable">@1</span>.<span class="hljs-number">0.2</span>, lodash._reevaluate<span class="hljs-variable">@3</span>.<span class="hljs-number">0.0</span>, lodash._reescape<span class="hljs-variable">@3</span>.<span class="hljs-number">0.0</span>, lodash._reinterpolate<span class="hljs-variable">@3</span>.<span class="hljs-number">0.0</span>, replace-ext<span class="hljs-variable">@0</span>.<span class="hljs-number">0.1</span>, minimist<span class="hljs-variable">@1</span>.<span class="hljs-number">1.1</span>, vinyl<span class="hljs-variable">@0</span>.<span class="hljs-number">4.6</span>, through2<span class="hljs-variable">@0</span>.<span class="hljs-number">6.3</span>, multipipe<span class="hljs-variable">@0</span>.<span class="hljs-number">1.2</span>, lodash.template<span class="hljs-variable">@3</span>.<span class="hljs-number">3.2</span>, dateformat<span class="hljs-variable">@1</span>.<span class="hljs-number">0.11</span>)<br>└── <span class="hljs-selector-tag">imagemin</span>@<span class="hljs-number">3.1</span><span class="hljs-selector-class">.0</span> (get-stdin<span class="hljs-variable">@3</span>.<span class="hljs-number">0.2</span>, optional<span class="hljs-variable">@0</span>.<span class="hljs-number">1.3</span>, vinyl<span class="hljs-variable">@0</span>.<span class="hljs-number">4.6</span>, through2<span class="hljs-variable">@0</span>.<span class="hljs-number">6.3</span>, stream-combiner<span class="hljs-variable">@0</span>.<span class="hljs-number">2.1</span>, concat-stream<span class="hljs-variable">@1</span>.<span class="hljs-number">4.7</span>, meow<span class="hljs-variable">@2</span>.<span class="hljs-number">1.0</span>, vinyl-fs<span class="hljs-variable">@0</span>.<span class="hljs-number">3.13</span>, imagemin-svgo<span class="hljs-variable">@4</span>.<span class="hljs-number">1.2</span>, imagemin-optipng<span class="hljs-variable">@4</span>.<span class="hljs-number">2.0</span>, imagemin-jpegtran<span class="hljs-variable">@4</span>.<span class="hljs-number">1.0</span>, imagemin-pngquant<span class="hljs-variable">@4</span>.<span class="hljs-number">0.0</span>, imagemin-gifsicle<span class="hljs-variable">@4</span>.<span class="hljs-number">1.0</span>)<br></code></pre></td></tr></table></figure>

<h3 id="5-2-创建-gulpfile-js-文件编写代码"><a href="#5-2-创建-gulpfile-js-文件编写代码" class="headerlink" title="5.2 创建 gulpfile.js 文件编写代码"></a>5.2 创建 <code>gulpfile.js</code> 文件编写代码</h3><hr>
<p>在对应目录创建 <code>gulpfile.js</code> 文件并写入如下内容：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> 获取 gulp<br>var gulp = require(<span class="hljs-string">&#x27;gulp&#x27;</span>);<br><br><span class="hljs-regexp">//</span> 获取 gulp-imagemin 模块<br>var imagemin = require(<span class="hljs-string">&#x27;gulp-imagemin&#x27;</span>)<br><br><span class="hljs-regexp">//</span> 压缩图片任务<br><span class="hljs-regexp">//</span> 在命令行输入 gulp images 启动此任务<br>gulp.task(<span class="hljs-string">&#x27;images&#x27;</span>, <span class="hljs-keyword">function</span> () &#123;<br>    <span class="hljs-regexp">//</span> <span class="hljs-number">1</span>. 找到图片<br>    gulp.src(<span class="hljs-string">&#x27;images/*.*&#x27;</span>)<br>    <span class="hljs-regexp">//</span> <span class="hljs-number">2</span>. 压缩图片<br>        .pipe(imagemin(&#123;<br>            progressive: true<br>        &#125;))<br>    <span class="hljs-regexp">//</span> <span class="hljs-number">3</span>. 另存图片<br>        .pipe(gulp.dest(<span class="hljs-string">&#x27;dist/images&#x27;</span>))<br>&#125;);<br><br><span class="hljs-regexp">//</span> 在命令行使用 gulp auto 启动此任务<br>gulp.task(<span class="hljs-string">&#x27;auto&#x27;</span>, <span class="hljs-keyword">function</span> () &#123;<br>    <span class="hljs-regexp">//</span> 监听文件修改，当文件被修改则执行 images 任务<br>    gulp.watch(<span class="hljs-string">&#x27;images/*.*)&#x27;</span>, [<span class="hljs-string">&#x27;images&#x27;</span>])<br>&#125;);<br><br><span class="hljs-regexp">//</span> 使用 gulp.task(<span class="hljs-string">&#x27;default&#x27;</span>) 定义默认任务<br><span class="hljs-regexp">//</span> 在命令行使用 gulp 启动 images 任务和 auto 任务<br>gulp.task(<span class="hljs-string">&#x27;default&#x27;</span>, [<span class="hljs-string">&#x27;images&#x27;</span>, <span class="hljs-string">&#x27;auto&#x27;</span>])<br></code></pre></td></tr></table></figure>

<p>你可以访问 <a target="_blank" rel="noopener" href="https://github.com/sindresorhus/gulp-imagemin">gulp-imagemin</a> 以查看更多用法。</p>
<hr>
<h3 id="5-3-在-images-目录下存放图片"><a href="#5-3-在-images-目录下存放图片" class="headerlink" title="5.3 在 images/ 目录下存放图片"></a>5.3 在 <code>images/</code> 目录下存放图片</h3><hr>
<p>在 <code>gulpfile.js</code> 对应目录创建 <code>images</code> 文件夹，并在 <code>images/</code> 目录下存放图片。</p>
<h3 id="5-4-运行-gulp-查看效果"><a href="#5-4-运行-gulp-查看效果" class="headerlink" title="5.4 运行 gulp 查看效果"></a>5.4 运行 gulp 查看效果</h3><hr>
<p>在命令行输入 <code>gulp</code> +回车</p>
<p>你将看到命令行出现如下提示</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs prolog">gulp<br>[<span class="hljs-number">18</span>:<span class="hljs-number">10</span>:<span class="hljs-number">42</span>] <span class="hljs-symbol">Using</span> gulpfile ~/<span class="hljs-symbol">Documents</span>/code/gulp-book/demo/chapter4/gulpfile.js<br>[<span class="hljs-number">18</span>:<span class="hljs-number">10</span>:<span class="hljs-number">42</span>] <span class="hljs-symbol">Starting</span> <span class="hljs-string">&#x27;images&#x27;</span>...<br>[<span class="hljs-number">18</span>:<span class="hljs-number">10</span>:<span class="hljs-number">42</span>] <span class="hljs-symbol">Finished</span> <span class="hljs-string">&#x27;images&#x27;</span> after <span class="hljs-number">5.72</span> ms<br>[<span class="hljs-number">18</span>:<span class="hljs-number">10</span>:<span class="hljs-number">42</span>] <span class="hljs-symbol">Starting</span> <span class="hljs-string">&#x27;auto&#x27;</span>...<br>[<span class="hljs-number">18</span>:<span class="hljs-number">10</span>:<span class="hljs-number">42</span>] <span class="hljs-symbol">Finished</span> <span class="hljs-string">&#x27;auto&#x27;</span> after <span class="hljs-number">6.39</span> ms<br>[<span class="hljs-number">18</span>:<span class="hljs-number">10</span>:<span class="hljs-number">42</span>] <span class="hljs-symbol">Starting</span> <span class="hljs-string">&#x27;default&#x27;</span>...<br>[<span class="hljs-number">18</span>:<span class="hljs-number">10</span>:<span class="hljs-number">42</span>] <span class="hljs-symbol">Finished</span> <span class="hljs-string">&#x27;default&#x27;</span> after <span class="hljs-number">5.91</span> μs<br>[<span class="hljs-number">18</span>:<span class="hljs-number">10</span>:<span class="hljs-number">42</span>] gulp-imagemin: <span class="hljs-symbol">Minified</span> <span class="hljs-number">3</span> images (saved <span class="hljs-number">25.83</span> kB - <span class="hljs-number">5.2</span><span class="hljs-comment">%)</span><br></code></pre></td></tr></table></figure>

<h2 id="使用-gulp-编译-LESS"><a href="#使用-gulp-编译-LESS" class="headerlink" title="使用 gulp 编译 LESS"></a>使用 gulp 编译 LESS</h2><blockquote>
<p>Less 是一门 CSS 预处理语言，它扩充了 CSS 语言，增加了诸如变量、混合（mixin）、函数等功能，让 CSS 更易维护。</p>
</blockquote>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">npm <span class="hljs-keyword">install</span> gulp-<span class="hljs-keyword">less</span><br></code></pre></td></tr></table></figure>

<h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> 获取 gulp<br>var gulp = require(<span class="hljs-string">&#x27;gulp&#x27;</span>)<br><span class="hljs-regexp">//</span> 获取 gulp-less 模块<br>var less = require(<span class="hljs-string">&#x27;gulp-less&#x27;</span>)<br><br><span class="hljs-regexp">//</span> 编译less<br><span class="hljs-regexp">//</span> 在命令行输入 gulp less 启动此任务<br>gulp.task(<span class="hljs-string">&#x27;less&#x27;</span>, <span class="hljs-keyword">function</span> () &#123;<br>    <span class="hljs-regexp">//</span> <span class="hljs-number">1</span>. 找到 less 文件<br>    gulp.src(<span class="hljs-string">&#x27;less/**.less&#x27;</span>)<br>    <span class="hljs-regexp">//</span> <span class="hljs-number">2</span>. 编译为css<br>        .pipe(less())<br>    <span class="hljs-regexp">//</span> <span class="hljs-number">3</span>. 另存文件<br>        .pipe(gulp.dest(<span class="hljs-string">&#x27;dist/css&#x27;</span>))<br>&#125;);<br><br><span class="hljs-regexp">//</span> 在命令行使用 gulp auto 启动此任务<br>gulp.task(<span class="hljs-string">&#x27;auto&#x27;</span>, <span class="hljs-keyword">function</span> () &#123;<br>    <span class="hljs-regexp">//</span> 监听文件修改，当文件被修改则执行 less 任务<br>    gulp.watch(<span class="hljs-string">&#x27;less/**.less&#x27;</span>, [<span class="hljs-string">&#x27;less&#x27;</span>])<br>&#125;)<br><br><span class="hljs-regexp">//</span> 使用 gulp.task(<span class="hljs-string">&#x27;default&#x27;</span>) 定义默认任务<br><span class="hljs-regexp">//</span> 在命令行使用 gulp 启动 less 任务和 auto 任务<br>gulp.task(<span class="hljs-string">&#x27;default&#x27;</span>, [<span class="hljs-string">&#x27;less&#x27;</span>, <span class="hljs-string">&#x27;auto&#x27;</span>])<br></code></pre></td></tr></table></figure>

<p>你可以访问 <a target="_blank" rel="noopener" href="https://github.com/plus3network/gulp-less">gulp-less</a> 以查看更多用法。</p>
<h2 id="LESS-代码和编译后的CSS代码"><a href="#LESS-代码和编译后的CSS代码" class="headerlink" title="LESS 代码和编译后的CSS代码"></a>LESS 代码和编译后的CSS代码</h2><p><a target="_blank" rel="noopener" href="https://github.com/nimojs/gulp-book/tree/master/demo/chapter5/less/a.less">less&#x2F;a.less</a></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.less</span>&#123;<br>	<span class="hljs-selector-tag">a</span>&#123;<br>        <span class="hljs-attribute">color</span>:pink;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/nimojs/gulp-book/tree/master/demo/chapter5/less/import.less">less&#x2F;import.less</a></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-keyword">@import</span> <span class="hljs-string">&quot;a.less&quot;</span>;<br><span class="hljs-selector-class">.import</span>&#123;<br>	<span class="hljs-selector-tag">a</span>&#123;<br>		<span class="hljs-attribute">color</span>:red;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/nimojs/gulp-book/tree/master/demo/chapter5/dist/css/a.css">less&#x2F;a.css</a></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.less</span> <span class="hljs-selector-tag">a</span> &#123;<br>  <span class="hljs-attribute">color</span>: pink;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/nimojs/gulp-book/tree/master/demo/chapter5/dist/css/import.css">less&#x2F;import.css</a></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.less</span> <span class="hljs-selector-tag">a</span> &#123;<br>  <span class="hljs-attribute">color</span>: pink;<br>&#125;<br><span class="hljs-selector-class">.import</span> <span class="hljs-selector-tag">a</span>&#123;<br>  <span class="hljs-attribute">color</span>: red;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="六、使用-gulp-编译-Sass"><a href="#六、使用-gulp-编译-Sass" class="headerlink" title="六、使用 gulp 编译 Sass"></a>六、使用 gulp 编译 Sass</h2><hr>
<blockquote>
<p>无论是 <code>node-sass</code> 还是 <code>ruby-sass</code> 使用 npm 安装都非常的慢，甚至会装不上。及其不利于团队协作。建议使用 less 作为 css 预处理器。<br>如果因为 less 不支持自定义函数选择用 sass 可以使用 <a target="_blank" rel="noopener" href="https://github.com/seven-phases-max/less-plugin-functions">less-plugin-functions</a> 让 less 支持自定义函数。</p>
</blockquote>
<h3 id="6-1-gulp-sass"><a href="#6-1-gulp-sass" class="headerlink" title="6.1 gulp-sass"></a>6.1 gulp-sass</h3><hr>
<p>本章使用的是 ruby-sass 如果你不方便安装 ruby 或编译速度慢，建议使用 <a target="_blank" rel="noopener" href="https://github.com/dlmanning/gulp-sass">gulp-sass</a></p>
<blockquote>
<p>Sass 是一种 CSS 的开发工具，提供了许多便利的写法，大大节省了开发者的时间，使得 CSS 的开发，变得简单和可维护。</p>
</blockquote>
<p>本章使用 <code>ruby-sass</code> 编译 css,若你没有安装 ruby 和 sass 请移步 <a target="_blank" rel="noopener" href="https://github.com/nimojs/blog/issues/14">使用ruby.taobao安装 Sass</a></p>
<h3 id="6-2-安装"><a href="#6-2-安装" class="headerlink" title="6.2 安装"></a>6.2 安装</h3><hr>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">npm <span class="hljs-keyword">install</span> gulp-ruby-sass<br></code></pre></td></tr></table></figure>

<h3 id="6-3-基本用法"><a href="#6-3-基本用法" class="headerlink" title="6.3 基本用法"></a>6.3 基本用法</h3><hr>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> 获取 gulp<br>var gulp = require(<span class="hljs-string">&#x27;gulp&#x27;</span>)<br><span class="hljs-regexp">//</span> 获取 gulp-ruby-sass 模块<br>var sass = require(<span class="hljs-string">&#x27;gulp-ruby-sass&#x27;</span>)<br><br><span class="hljs-regexp">//</span> 编译sass<br><span class="hljs-regexp">//</span> 在命令行输入 gulp sass 启动此任务<br>gulp.task(<span class="hljs-string">&#x27;sass&#x27;</span>, <span class="hljs-keyword">function</span>() &#123;<br>    return sass(<span class="hljs-string">&#x27;sass/&#x27;</span>) <br>    .on(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-keyword">function</span> (err) &#123;<br>      console.error(<span class="hljs-string">&#x27;Error!&#x27;</span>, err.message);<br>   &#125;)<br>    .pipe(gulp.dest(<span class="hljs-string">&#x27;dist/css&#x27;</span>))<br>&#125;);<br><br><br><span class="hljs-regexp">//</span> 在命令行使用 gulp auto 启动此任务<br>gulp.task(<span class="hljs-string">&#x27;auto&#x27;</span>, <span class="hljs-keyword">function</span> () &#123;<br>    <span class="hljs-regexp">//</span> 监听文件修改，当文件被修改则执行 images 任务<br>    gulp.watch(<span class="hljs-string">&#x27;sass/**/*.scss&#x27;</span>, [<span class="hljs-string">&#x27;sass&#x27;</span>])<br>&#125;);<br><br><span class="hljs-regexp">//</span> 使用 gulp.task(<span class="hljs-string">&#x27;default&#x27;</span>) 定义默认任务<br><span class="hljs-regexp">//</span> 在命令行使用 gulp 启动 sass 任务和 auto 任务<br>gulp.task(<span class="hljs-string">&#x27;default&#x27;</span>, [<span class="hljs-string">&#x27;sass&#x27;</span>, <span class="hljs-string">&#x27;auto&#x27;</span>])<br></code></pre></td></tr></table></figure>

<p>Sass 代码和编译后的 CSS 代码</p>
<p><a target="_blank" rel="noopener" href="https://github.com/nimojs/gulp-book/tree/master/demo/chapter6/sass/a.scss">sass&#x2F;a.scss</a></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.sass</span>&#123;<br>	<span class="hljs-selector-tag">a</span>&#123;<br>        <span class="hljs-attribute">color</span>:pink;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/nimojs/gulp-book/tree/master/demo/chapter6/sass/import.scss">sass&#x2F;import.scss</a></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-keyword">@import</span> <span class="hljs-string">&quot;a.scss&quot;</span>;<br><span class="hljs-selector-class">.import</span>&#123;<br>	<span class="hljs-selector-tag">a</span>&#123;<br>		<span class="hljs-attribute">color</span>:red;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/nimojs/gulp-book/tree/master/demo/chapter6/dist/css/a.css">sass&#x2F;a.css</a></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.sass</span> <span class="hljs-selector-tag">a</span> &#123;<br>  <span class="hljs-attribute">color</span>: pink;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/nimojs/gulp-book/tree/master/demo/chapter6/dist/css/import.css">sass&#x2F;import.css</a></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.sass</span> <span class="hljs-selector-tag">a</span> &#123;<br>  <span class="hljs-attribute">color</span>: pink;<br>&#125;<br><span class="hljs-selector-class">.import</span> <span class="hljs-selector-tag">a</span>&#123;<br>  <span class="hljs-attribute">color</span>: red;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="七、使用-gulp-构建一个项目"><a href="#七、使用-gulp-构建一个项目" class="headerlink" title="七、使用 gulp 构建一个项目"></a>七、使用 gulp 构建一个项目</h2><hr>
<p>本章将介绍</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/nimojs/gulp-watch-path">gulp-watch-path</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/gulpjs/gulp/blob/master/docs/recipes/combining-streams-to-handle-errors.md">stream-combiner2</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/floridoo/gulp-sourcemaps">gulp-sourcemaps</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/sindresorhus/gulp-autoprefixer/blob/master/package.json">gulp-autoprefixer</a></li>
</ul>
<p>并将之前所有章节的内容组合起来编写一个前端项目所需的 gulp 代码。</p>
<p>若你不了解npm 请务必阅读 <a target="_blank" rel="noopener" href="http://javascript.ruanyifeng.com/nodejs/npm.html">npm模块管理器</a></p>
<h3 id="7-1-package-json"><a href="#7-1-package-json" class="headerlink" title="7.1 package.json"></a>7.1 package.json</h3><hr>
<p>如果你熟悉 npm 则可以利用 <code>package.json</code> 保存所有 <code>npm install --save-dev gulp-xxx</code> 模块依赖和模块版本。</p>
<p>在命令行输入</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-built_in">npm</span> init<br></code></pre></td></tr></table></figure>

<p>会依次要求补全项目信息，不清楚的可以直接回车跳过</p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs subunit">name: (gulp-demo) <br>version: (1.0.0) <br>description: <br>entry point: (index.js) <br><span class="hljs-keyword">test </span>command: <br>...<br>...<br>Is this ok? (yes)<br></code></pre></td></tr></table></figure>



<p>最终会在当前目录中创建 <code>package.json</code> 文件并生成类似如下代码：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs stata">&#123;<br>  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;gulp-demo&quot;</span>,<br>  <span class="hljs-string">&quot;version&quot;</span>: <span class="hljs-string">&quot;0.0.0&quot;</span>,<br>  <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>  <span class="hljs-string">&quot;scripts&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;test&quot;</span>: <span class="hljs-string">&quot;echo \&quot;</span><span class="hljs-keyword">Error</span>: <span class="hljs-keyword">no</span> <span class="hljs-keyword">test</span> specified\<span class="hljs-string">&quot; &amp;&amp; exit 1&quot;</span><br>  &#125;,<br>  <span class="hljs-string">&quot;repository&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;git&quot;</span>,<br>    <span class="hljs-string">&quot;url&quot;</span>: <span class="hljs-string">&quot;https://github.com/nimojs/gulp-demo.git&quot;</span><br>  &#125;,<br>  <span class="hljs-string">&quot;keywords&quot;</span>: [<br>    <span class="hljs-string">&quot;gulp&quot;</span>,<br>  ],<br>  <span class="hljs-string">&quot;author&quot;</span>: <span class="hljs-string">&quot;nimojs &lt;nimo.jser@gmail.com&gt;&quot;</span>,<br>  <span class="hljs-string">&quot;license&quot;</span>: <span class="hljs-string">&quot;MIT&quot;</span>,<br>  <span class="hljs-string">&quot;bugs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;url&quot;</span>: <span class="hljs-string">&quot;https://github.com/nimojs/gulp-demo/issues&quot;</span><br>  &#125;,<br>  <span class="hljs-string">&quot;homepage&quot;</span>: <span class="hljs-string">&quot;https://github.com/nimojs/gulp-demo&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="7-2-安装依赖"><a href="#7-2-安装依赖" class="headerlink" title="7.2 安装依赖"></a>7.2 安装依赖</h3><hr>
<p>安装 gulp 到项目（防止全局 gulp 升级后与此项目 <code>gulpfile.js</code> 代码不兼容）</p>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs q">npm install gulp --<span class="hljs-built_in">save</span>-<span class="hljs-built_in">dev</span><br></code></pre></td></tr></table></figure>



<p>此时打开 <code>package.json</code> 会发现多了如下代码</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;devDependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>	<span class="hljs-attr">&quot;gulp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^3.8.11&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p>声明此项目的开发依赖 gulp</p>
<p>接着安装其他依赖：</p>
<blockquote>
<p>安装模块较多，请耐心等待，若一直安装失败可使用<a target="_blank" rel="noopener" href="http://npm.taobao.org/">npm.taobao.org</a></p>
</blockquote>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">npm <span class="hljs-keyword">install</span> gulp-uglify gulp-watch-path stream-combiner2 gulp-sourcemaps gulp-minify-css gulp-autoprefixer gulp-<span class="hljs-keyword">less</span> gulp-ruby-sass gulp-imagemin gulp-util --save-dev<br></code></pre></td></tr></table></figure>

<p>此时，<a target="_blank" rel="noopener" href="https://github.com/nimojs/gulp-demo/blob/master/package.json">package.json</a> 将会更新</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;devDependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;colors&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^1.0.3&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;gulp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^3.8.11&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;gulp-autoprefixer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^2.1.0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;gulp-imagemin&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^2.2.1&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;gulp-less&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^3.0.2&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;gulp-minify-css&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^1.0.0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;gulp-ruby-sass&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^1.0.1&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;gulp-sourcemaps&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^1.5.1&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;gulp-uglify&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^1.1.0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;gulp-watch-path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^0.0.7&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;stream-combiner2&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^1.0.2&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>



<p>当你将这份 gulpfile.js 配置分享给你的朋友时，就不需要将 <code>node_modules/</code> 发送给他，他只需在命令行输入</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">npm <span class="hljs-keyword">install</span><br></code></pre></td></tr></table></figure>



<p>就可以检测 <code>package.json</code> 中的 <code>devDependencies</code> 并安装所有依赖。</p>
<h3 id="7-3-设计目录结构"><a href="#7-3-设计目录结构" class="headerlink" title="7.3 设计目录结构"></a>7.3 设计目录结构</h3><hr>
<p>我们将文件分为2类，一类是源码，一类是编译压缩后的版本。文件夹分别为 <code>src</code> 和 <code>dist</code>。(注意区分 <code>dist</code> 和 ·<code>dest</code> 的区别)</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css">└── <span class="hljs-attribute">src</span>/<br>│<br>└── dist/<br></code></pre></td></tr></table></figure>

<p><code>dist/</code> 目录下的文件都是根据 <code>src/</code> 下所有源码文件构建而成。</p>
<p>在 <code>src/</code> 下创建前端资源对应的的文件夹</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus">└── <span class="hljs-attribute">src</span>/<br>	├── less/    *<span class="hljs-selector-class">.less</span> 文件<br>	├── sass/    *<span class="hljs-selector-class">.scss</span> *<span class="hljs-selector-class">.sass</span> 文件<br>	├── css/     *<span class="hljs-selector-class">.css</span>  文件<br>	├── js/      *<span class="hljs-selector-class">.js</span> 文件<br>	├── fonts/   字体文件<br>    └── images/   图片<br>└── dist/<br></code></pre></td></tr></table></figure>

<h3 id="7-4-让命令行输出的文字带颜色"><a href="#7-4-让命令行输出的文字带颜色" class="headerlink" title="7.4 让命令行输出的文字带颜色"></a>7.4 让命令行输出的文字带颜色</h3><hr>
<p>gulp 自带的输出都带时间和颜色，这样很容易识别。我们利用 <a target="_blank" rel="noopener" href="https://github.com/gulpjs/gulp-util">gulp-util</a> 实现同样的效果。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-tag">var</span> gulp = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;gulp&#x27;</span>)<br><span class="hljs-selector-tag">var</span> gutil = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;gulp-util&#x27;</span>)<br><br>gulp<span class="hljs-selector-class">.task</span>(<span class="hljs-string">&#x27;default&#x27;</span>, function () &#123;<br>    gutil<span class="hljs-selector-class">.log</span>(<span class="hljs-string">&#x27;message&#x27;</span>)<br>    gutil<span class="hljs-selector-class">.log</span>(gutil<span class="hljs-selector-class">.colors</span><span class="hljs-selector-class">.red</span>(<span class="hljs-string">&#x27;error&#x27;</span>))<br>    gutil<span class="hljs-selector-class">.log</span>(gutil<span class="hljs-selector-class">.colors</span><span class="hljs-selector-class">.green</span>(<span class="hljs-string">&#x27;message:&#x27;</span>) + <span class="hljs-string">&quot;some&quot;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>使用 <code>gulp</code> 启动默认任务以测试<br><img src="https://cloud.githubusercontent.com/assets/3949015/7137629/a1def1b8-e2ed-11e4-83e0-5a6adb22de6f.png" srcset="/img/loading.gif" lazyload alt="gulp-util"></p>
<h3 id="7-5-配置-JS-任务"><a href="#7-5-配置-JS-任务" class="headerlink" title="7.5 配置 JS 任务"></a>7.5 配置 JS 任务</h3><h4 id="7-5-1-gulp-uglify"><a href="#7-5-1-gulp-uglify" class="headerlink" title="7.5.1 gulp-uglify"></a>7.5.1 gulp-uglify</h4><p>检测<code>src/js/</code>目录下的 js 文件修改后，压缩 <code>js/</code> 中所有 js 文件并输出到 <code>dist/js/</code> 中</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-tag">var</span> uglify = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;gulp-uglify&#x27;</span>)<br><br>gulp<span class="hljs-selector-class">.task</span>(<span class="hljs-string">&#x27;uglifyjs&#x27;</span>, function () &#123;<br>    gulp<span class="hljs-selector-class">.src</span>(<span class="hljs-string">&#x27;src/js/**/*.js&#x27;</span>)<br>        <span class="hljs-selector-class">.pipe</span>(<span class="hljs-built_in">uglify</span>())<br>        <span class="hljs-selector-class">.pipe</span>(gulp<span class="hljs-selector-class">.dest</span>(<span class="hljs-string">&#x27;dist/js&#x27;</span>))<br>&#125;)<br><br>gulp<span class="hljs-selector-class">.task</span>(<span class="hljs-string">&#x27;default&#x27;</span>, function () &#123;<br>    gulp<span class="hljs-selector-class">.watch</span>(<span class="hljs-string">&#x27;src/js/**/*.js&#x27;</span>, <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;uglifyjs&#x27;</span>]</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>

<p><code>src/js/**/*.js</code> 是 glob 语法。<a target="_blank" rel="noopener" href="http://baike.baidu.com/view/4019153.htm">百度百科：glob模式</a> 、<a target="_blank" rel="noopener" href="https://github.com/isaacs/node-glob">node-glob</a></p>
<p>在命令行输入 <code>gulp</code> 后会出现如下消息，表示已经启动。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">[<span class="hljs-number">20</span>:<span class="hljs-number">39</span>:<span class="hljs-number">50</span>] Using gulpfile ~<span class="hljs-regexp">/Documents/</span>code<span class="hljs-regexp">/gulp-book/</span>demo<span class="hljs-regexp">/chapter7/gu</span>lpfile.js<br>[<span class="hljs-number">20</span>:<span class="hljs-number">39</span>:<span class="hljs-number">50</span>] Starting <span class="hljs-string">&#x27;default&#x27;</span>...<br>[<span class="hljs-number">20</span>:<span class="hljs-number">39</span>:<span class="hljs-number">50</span>] Finished <span class="hljs-string">&#x27;default&#x27;</span> after <span class="hljs-number">13</span> ms<br></code></pre></td></tr></table></figure>



<p>此时编辑 <a target="_blank" rel="noopener" href="https://github.com/nimojs/gulp-demo/blob/master/src/js/log.js">src&#x2F;js&#x2F;log.js</a> 文件并保存，命令行会出现如下消息，表示检测到 <code>src/js/**/*.js</code> 文件修改后重新编译所有 js。</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs prolog">[<span class="hljs-number">20</span>:<span class="hljs-number">39</span>:<span class="hljs-number">52</span>] <span class="hljs-symbol">Starting</span> <span class="hljs-string">&#x27;js&#x27;</span>...<br>[<span class="hljs-number">20</span>:<span class="hljs-number">39</span>:<span class="hljs-number">52</span>] <span class="hljs-symbol">Finished</span> <span class="hljs-string">&#x27;js&#x27;</span> after <span class="hljs-number">14</span> ms<br></code></pre></td></tr></table></figure>

<h4 id="7-5-2gulp-watch-path"><a href="#7-5-2gulp-watch-path" class="headerlink" title="7.5.2gulp-watch-path"></a>7.5.2gulp-watch-path</h4><hr>
<p>此配置有个性能问题，当 <code>gulp.watch</code> 检测到 <code>src/js/</code> 目录下的js文件有修改时会将所有文件全部编译。实际上我们只需要重新编译被修改的文件。</p>
<p>简单介绍 <code>gulp.watch</code> 第二个参数为 <code>function</code> 时的用法。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs awk">gulp.watch(<span class="hljs-string">&#x27;src/js/**/*.js&#x27;</span>, <span class="hljs-keyword">function</span> (event) &#123;<br>    console.log(event);<br>    /*<br>	当修改 src<span class="hljs-regexp">/js/</span>log.js 文件时<br>    event &#123;<br>		<span class="hljs-regexp">//</span> 发生改变的类型，不管是添加，改变或是删除<br>        type: <span class="hljs-string">&#x27;changed&#x27;</span>, <br>		<span class="hljs-regexp">//</span> 触发事件的文件路径<br>        path: <span class="hljs-string">&#x27;/Users/nimojs/Documents/code/gulp-book/demo/chapter7/src/js/log.js&#x27;</span><br>    &#125;<br>    */<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>我们可以利用 <code>event</code> 给到的信息，检测到某个 js 文件被修改时，只编写当前修改的 js 文件。</p>
<p>可以利用 <code>gulp-watch-path</code> 配合 <code>event</code> 获取编译路径和输出路径。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-tag">var</span> watchPath = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;gulp-watch-path&#x27;</span>)<br><br>gulp<span class="hljs-selector-class">.task</span>(<span class="hljs-string">&#x27;watchjs&#x27;</span>, function () &#123;<br>    gulp<span class="hljs-selector-class">.watch</span>(<span class="hljs-string">&#x27;src/js/**/*.js&#x27;</span>, function (event) &#123;<br>        <span class="hljs-selector-tag">var</span> paths = <span class="hljs-built_in">watchPath</span>(event, <span class="hljs-string">&#x27;src/&#x27;</span>, <span class="hljs-string">&#x27;dist/&#x27;</span>)<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        paths</span><br><span class="hljs-comment">            &#123; srcPath: &#x27;src/js/log.js&#x27;,</span><br><span class="hljs-comment">              srcDir: &#x27;src/js/&#x27;,</span><br><span class="hljs-comment">              distPath: &#x27;dist/js/log.js&#x27;,</span><br><span class="hljs-comment">              distDir: &#x27;dist/js/&#x27;,</span><br><span class="hljs-comment">              srcFilename: &#x27;log.js&#x27;,</span><br><span class="hljs-comment">              distFilename: &#x27;log.js&#x27; &#125;</span><br><span class="hljs-comment">        */</span><br>		gutil<span class="hljs-selector-class">.log</span>(gutil<span class="hljs-selector-class">.colors</span><span class="hljs-selector-class">.green</span>(event.type) + <span class="hljs-string">&#x27; &#x27;</span> + paths.srcPath)<br>        gutil<span class="hljs-selector-class">.log</span>(<span class="hljs-string">&#x27;Dist &#x27;</span> + paths.distPath)<br><br>        gulp<span class="hljs-selector-class">.src</span>(paths.srcPath)<br>            <span class="hljs-selector-class">.pipe</span>(<span class="hljs-built_in">uglify</span>())<br>            <span class="hljs-selector-class">.pipe</span>(gulp<span class="hljs-selector-class">.dest</span>(paths.distDir))<br>    &#125;)<br>&#125;)<br><br>gulp<span class="hljs-selector-class">.task</span>(<span class="hljs-string">&#x27;default&#x27;</span>, <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;watchjs&#x27;</span>]</span>)<br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/nimojs/gulp-book/tree/master/demo/chapter7/use-gulp-watch-path.js">use-gulp-watch-path 完整代码</a></p>
<h4 id="7-5-3-watchPath-event-search-replace-distExt"><a href="#7-5-3-watchPath-event-search-replace-distExt" class="headerlink" title="7.5.3 watchPath(event, search, replace, distExt)"></a>7.5.3 watchPath(event, search, replace, distExt)</h4><hr>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">event</td>
<td align="left"><code>gulp.watch</code> 回调函数的 <code>event</code></td>
</tr>
<tr>
<td align="left">search</td>
<td align="left">需要被替换的起始字符串</td>
</tr>
<tr>
<td align="left">replace</td>
<td align="left">第三个参数是新的的字符串</td>
</tr>
<tr>
<td align="left">distExt</td>
<td align="left">扩展名(非必填)</td>
</tr>
</tbody></table>
<p>此时编辑 <a target="_blank" rel="noopener" href="https://github.com/nimojs/gulp-demo/blob/master/src/js/log.js">src&#x2F;js&#x2F;log.js</a> 文件并保存，命令行会出现消息，表示检测到 <code>src/js/log.js</code> 文件修改后只重新编译 <code>log.js</code>。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">[<span class="hljs-number">21</span>:<span class="hljs-number">47</span>:<span class="hljs-number">25</span>] changed src<span class="hljs-regexp">/js/</span>log.js<br>[<span class="hljs-number">21</span>:<span class="hljs-number">47</span>:<span class="hljs-number">25</span>] Dist dist<span class="hljs-regexp">/js/</span>log.js<br></code></pre></td></tr></table></figure>

<p>你可以访问 <a target="_blank" rel="noopener" href="https://github.com/nimojs/gulp-watch-path">gulp-watch-path</a> 了解更多。</p>
<h4 id="7-5-4-stream-combiner2"><a href="#7-5-4-stream-combiner2" class="headerlink" title="7.5.4 stream-combiner2"></a>7.5.4 stream-combiner2</h4><hr>
<p>编辑 <code>log.js</code> 文件时，如果文件中有 js 语法错误时，gulp 会终止运行并报错。</p>
<p>当 log.js 缺少 <code>)</code></p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-built_in">log</span>(&#x27;gulp-book&#x27;<br></code></pre></td></tr></table></figure>



<p>并保存文件时出现如下错误，但是错误信息不全面。而且还会让 gulp 停止运行。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs awk">events.js:<span class="hljs-number">85</span><br>      throw er; <span class="hljs-regexp">//</span> Unhandled <span class="hljs-string">&#x27;error&#x27;</span> event<br>            ^<br>Error<br>    at new JS_Parse_Error (<span class="hljs-regexp">/Users/</span>nimojs<span class="hljs-regexp">/Documents/</span>code<span class="hljs-regexp">/gulp-book/</span>demo<span class="hljs-regexp">/chapter7/</span>node_modules<span class="hljs-regexp">/gulp-uglify/</span>node_modules<span class="hljs-regexp">/uglify-js/</span>lib/parse.js:<span class="hljs-number">189</span>:<span class="hljs-number">18</span>)<br>...<br>...<br>js_error (<span class="hljs-regexp">/Users/</span>nimojs<span class="hljs-regexp">/Documents/</span>code<span class="hljs-regexp">/gulp-book/</span>demo<span class="hljs-regexp">/chapter7/</span>node_modules/gulp-<br>-book<span class="hljs-regexp">/demo/</span>chapter7<span class="hljs-regexp">/node_modules/gu</span>lp-uglify<span class="hljs-regexp">/node_modules/ug</span>lify-js<span class="hljs-regexp">/lib/</span>parse.js:<span class="hljs-number">1165</span>:<span class="hljs-number">20</span>)<br>    at maybe_unary (<span class="hljs-regexp">/Users/</span>nimojs<span class="hljs-regexp">/Documents/</span>code<span class="hljs-regexp">/gulp-book/</span>demo<span class="hljs-regexp">/chapter7/</span>node_modules<span class="hljs-regexp">/gulp-uglify/</span>node_modules<span class="hljs-regexp">/uglify-js/</span>lib/parse.js:<span class="hljs-number">1328</span>:<span class="hljs-number">19</span>)<br></code></pre></td></tr></table></figure>

<p>应对这种情况，我们可以使用 <a target="_blank" rel="noopener" href="https://github.com/gulpjs/gulp/blob/master/docs/recipes/combining-streams-to-handle-errors.md">Combining streams to handle errors</a> 文档中推荐的 <a target="_blank" rel="noopener" href="https://github.com/substack/stream-combiner2">stream-combiner2</a> 捕获错误信息。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs lua">var handleError = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(err)</span></span> &#123;<br>    var colors = gutil.colors;<br>    console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>    gutil.<span class="hljs-built_in">log</span>(colors.red(<span class="hljs-string">&#x27;Error!&#x27;</span>))<br>    gutil.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;fileName: &#x27;</span> + colors.red(err.fileName))<br>    gutil.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;lineNumber: &#x27;</span> + colors.red(err.lineNumber))<br>    gutil.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;message: &#x27;</span> + err.message)<br>    gutil.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;plugin: &#x27;</span> + colors.yellow(err.plugin))<br>&#125;<br>var combiner = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;stream-combiner2&#x27;</span>)<br><br>gulp.task(<span class="hljs-string">&#x27;watchjs&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span></span> &#123;<br>    gulp.watch(<span class="hljs-string">&#x27;src/js/**/*.js&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(event)</span></span> &#123;<br>        var paths = watchPath(event, <span class="hljs-string">&#x27;src/&#x27;</span>, <span class="hljs-string">&#x27;dist/&#x27;</span>)<br>        /*<br>        paths<br>            &#123; srcPath: <span class="hljs-string">&#x27;src/js/log.js&#x27;</span>,<br>              srcDir: <span class="hljs-string">&#x27;src/js/&#x27;</span>,<br>              distPath: <span class="hljs-string">&#x27;dist/js/log.js&#x27;</span>,<br>              distDir: <span class="hljs-string">&#x27;dist/js/&#x27;</span>,<br>              srcFilename: <span class="hljs-string">&#x27;log.js&#x27;</span>,<br>              distFilename: <span class="hljs-string">&#x27;log.js&#x27;</span> &#125;<br>        */<br>        gutil.<span class="hljs-built_in">log</span>(gutil.colors.green(event.<span class="hljs-built_in">type</span>) + <span class="hljs-string">&#x27; &#x27;</span> + paths.srcPath)<br>        gutil.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;Dist &#x27;</span> + paths.distPath)<br><br>        var combined = combiner.obj([<br>            gulp.src(paths.srcPath),<br>            uglify(),<br>            gulp.dest(paths.distDir)<br>        ])<br><br>        combined.on(<span class="hljs-string">&#x27;error&#x27;</span>, handleError)<br>    &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>此时当编译错误的语法时，命令行会出现错误提示。而且不会让 gulp 停止运行。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">changed:src<span class="hljs-regexp">/js/</span>log.js<br>dist:dist<span class="hljs-regexp">/js/</span>log.js<br>--------------<br>Error!<br>fileName: <span class="hljs-regexp">/Users/</span>nimojs<span class="hljs-regexp">/Documents/</span>code<span class="hljs-regexp">/gulp-book/</span>demo<span class="hljs-regexp">/chapter7/</span>src<span class="hljs-regexp">/js/</span>log.js<br>lineNumber: <span class="hljs-number">7</span><br>message: <span class="hljs-regexp">/Users/</span>nimojs<span class="hljs-regexp">/Documents/</span>code<span class="hljs-regexp">/gulp-book/</span>demo<span class="hljs-regexp">/chapter7/</span>src<span class="hljs-regexp">/js/</span>log.js: Unexpected token eof «undefined», expected punc «,»<br>plugin: gulp-uglify<br></code></pre></td></tr></table></figure>

<h4 id="7-5-5-gulp-sourcemaps"><a href="#7-5-5-gulp-sourcemaps" class="headerlink" title="7.5.5 gulp-sourcemaps"></a>7.5.5 gulp-sourcemaps</h4><hr>
<p>JS 压缩前和压缩后比较</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-comment">// 压缩前</span><br><span class="hljs-keyword">var</span> <span class="hljs-built_in">log</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">msg</span>) &#123;<br>    <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;--------&#x27;</span>);<br>    <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(msg)<br>    <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;--------&#x27;</span>);<br>&#125;<br><span class="hljs-built_in">log</span>(&#123;<span class="hljs-attr">a</span>:<span class="hljs-number">1</span>&#125;)<br><span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;gulp-book&#x27;</span>)<br><br><span class="hljs-comment">// 压缩后</span><br><span class="hljs-keyword">var</span> <span class="hljs-built_in">log</span>=<span class="hljs-keyword">function</span>(<span class="hljs-params">o</span>)&#123;<span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;--------&quot;</span>),<span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(o),<span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;--------&quot;</span>)&#125;;<span class="hljs-built_in">log</span>(&#123;<span class="hljs-attr">a</span>:<span class="hljs-number">1</span>&#125;),<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;gulp-book&quot;</span>);<br></code></pre></td></tr></table></figure>



<p>压缩后的代码不存在换行符和空白符，导致出错后很难调试，好在我们可以使用 <a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html">sourcemap</a> 帮助调试</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">var</span> sourcemaps = require(<span class="hljs-string">&#x27;gulp-sourcemaps&#x27;</span>)<br><span class="hljs-comment">// ...</span><br><span class="hljs-keyword">var</span> combined = combiner.obj([<br>    gulp.src(paths.srcPath),<br>    sourcemaps.<span class="hljs-keyword">init</span>(),<br>    uglify(),<br>    sourcemaps.write(<span class="hljs-string">&#x27;./&#x27;</span>),<br>    gulp.dest(paths.distDir)<br>])<br><span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></figure>

<p>此时 <code>dist/js/</code> 中也会生成对应的 <code>.map</code> 文件，以便使用 Chrome 控制台调试代码 <a target="_blank" rel="noopener" href="https://github.com/nimojs/gulp-demo/blob/master/src/js/">在线文件示例：src&#x2F;js&#x2F;</a></p>
<hr>
<p>至此，我们完成了检测文件修改后压缩 JS 的 gulp 任务配置。</p>
<p>有时我们也需要一次编译所有 js 文件。可以配置 <code>uglifyjs</code> 任务。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">gulp.task(<span class="hljs-string">&#x27;uglifyjs&#x27;</span>, <span class="hljs-keyword">function</span> <span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">var</span> combined = combiner.obj([<br>        gulp.src(<span class="hljs-string">&#x27;src/js/**/*.js&#x27;</span>),<br>        sourcemaps.init(),<br>        uglify(),<br>        sourcemaps.write(<span class="hljs-string">&#x27;./&#x27;</span>),<br>        gulp.dest(<span class="hljs-string">&#x27;dist/js/&#x27;</span>)<br>    ])<br>    combined.on(<span class="hljs-string">&#x27;error&#x27;</span>, handleError)<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>在命令行输入 <code>gulp uglifyjs</code> 以压缩 <code>src/js/</code> 下的所有 js 文件。</p>
<h3 id="7-6-配置-CSS-任务"><a href="#7-6-配置-CSS-任务" class="headerlink" title="7.6 配置 CSS 任务"></a>7.6 配置 CSS 任务</h3><hr>
<p>有时我们不想使用 LESS 或 SASS而是直接编写 CSS，但我们需要压缩 CSS 以提高页面加载速度。</p>
<h4 id="7-6-1-gulp-minify-css"><a href="#7-6-1-gulp-minify-css" class="headerlink" title="7.6.1 gulp-minify-css"></a>7.6.1 gulp-minify-css</h4><hr>
<p>按照本章中压缩 JS 的方式，先编写 <code>watchcss</code> 任务</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-tag">var</span> minifycss = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;gulp-minify-css&#x27;</span>)<br><br>gulp<span class="hljs-selector-class">.task</span>(<span class="hljs-string">&#x27;watchcss&#x27;</span>, function () &#123;<br>    gulp<span class="hljs-selector-class">.watch</span>(<span class="hljs-string">&#x27;src/css/**/*.css&#x27;</span>, function (event) &#123;<br>        <span class="hljs-selector-tag">var</span> paths = <span class="hljs-built_in">watchPath</span>(event, <span class="hljs-string">&#x27;src/&#x27;</span>, <span class="hljs-string">&#x27;dist/&#x27;</span>)<br><br>		gutil<span class="hljs-selector-class">.log</span>(gutil<span class="hljs-selector-class">.colors</span><span class="hljs-selector-class">.green</span>(event.type) + <span class="hljs-string">&#x27; &#x27;</span> + paths.srcPath)<br>        gutil<span class="hljs-selector-class">.log</span>(<span class="hljs-string">&#x27;Dist &#x27;</span> + paths.distPath)<br><br>        gulp<span class="hljs-selector-class">.src</span>(paths.srcPath)<br>            <span class="hljs-selector-class">.pipe</span>(sourcemaps<span class="hljs-selector-class">.init</span>())<br>            <span class="hljs-selector-class">.pipe</span>(<span class="hljs-built_in">minifycss</span>())<br>            <span class="hljs-selector-class">.pipe</span>(sourcemaps<span class="hljs-selector-class">.write</span>(<span class="hljs-string">&#x27;./&#x27;</span>))<br>            <span class="hljs-selector-class">.pipe</span>(gulp<span class="hljs-selector-class">.dest</span>(paths.distDir))<br>    &#125;)<br>&#125;)<br><br>gulp<span class="hljs-selector-class">.task</span>(<span class="hljs-string">&#x27;default&#x27;</span>, <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;watchjs&#x27;</span>,<span class="hljs-string">&#x27;watchcss&#x27;</span>]</span>)<br></code></pre></td></tr></table></figure>

<h4 id="7-6-2-gulp-autoprefixer"><a href="#7-6-2-gulp-autoprefixer" class="headerlink" title="7.6.2 gulp-autoprefixer"></a>7.6.2 gulp-autoprefixer</h4><p>autoprefixer 解析 CSS 文件并且添加浏览器前缀到CSS规则里。<br>通过示例帮助理解</p>
<p>autoprefixer 处理前：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.demo</span> &#123;<br>    <span class="hljs-attribute">display</span>:flex;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>autoprefixer 处理后：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.demo</span> &#123;<br>    <span class="hljs-attribute">display</span>:-webkit-flex;<br>    <span class="hljs-attribute">display</span>:-ms-flexbox;<br>    <span class="hljs-attribute">display</span>:flex;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>你只需要关心编写标准语法的 css，autoprefixer 会自动补全。</p>
<p>在 watchcss 任务中加入 autoprefixer:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs stylus">gulp<span class="hljs-selector-class">.task</span>(<span class="hljs-string">&#x27;watchcss&#x27;</span>, function () &#123;<br>    gulp<span class="hljs-selector-class">.watch</span>(<span class="hljs-string">&#x27;src/css/**/*.css&#x27;</span>, function (event) &#123;<br>        <span class="hljs-selector-tag">var</span> paths = <span class="hljs-built_in">watchPath</span>(event, <span class="hljs-string">&#x27;src/&#x27;</span>, <span class="hljs-string">&#x27;dist/&#x27;</span>)<br><br>		gutil<span class="hljs-selector-class">.log</span>(gutil<span class="hljs-selector-class">.colors</span><span class="hljs-selector-class">.green</span>(event.type) + <span class="hljs-string">&#x27; &#x27;</span> + paths.srcPath)<br>        gutil<span class="hljs-selector-class">.log</span>(<span class="hljs-string">&#x27;Dist &#x27;</span> + paths.distPath)<br><br>        gulp<span class="hljs-selector-class">.src</span>(paths.srcPath)<br>            <span class="hljs-selector-class">.pipe</span>(sourcemaps<span class="hljs-selector-class">.init</span>())<br>            <span class="hljs-selector-class">.pipe</span>(<span class="hljs-built_in">autoprefixer</span>(&#123;<br>              browsers: <span class="hljs-string">&#x27;last 2 versions&#x27;</span><br>            &#125;))<br>            <span class="hljs-selector-class">.pipe</span>(<span class="hljs-built_in">minifycss</span>())<br>            <span class="hljs-selector-class">.pipe</span>(sourcemaps<span class="hljs-selector-class">.write</span>(<span class="hljs-string">&#x27;./&#x27;</span>))<br>            <span class="hljs-selector-class">.pipe</span>(gulp<span class="hljs-selector-class">.dest</span>(paths.distDir))<br>    &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>更多 autoprefixer 参数请查看 <a target="_blank" rel="noopener" href="https://github.com/sindresorhus/gulp-autoprefixer">gulp-autoprefixer</a></p>
<p>有时我们也需要一次编译所有 css 文件。可以配置 <code>minifyss</code> 任务。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs stylus">gulp<span class="hljs-selector-class">.task</span>(<span class="hljs-string">&#x27;minifycss&#x27;</span>, function () &#123;<br>    gulp<span class="hljs-selector-class">.src</span>(<span class="hljs-string">&#x27;src/css/**/*.css&#x27;</span>)<br>        <span class="hljs-selector-class">.pipe</span>(sourcemaps<span class="hljs-selector-class">.init</span>())<br>        <span class="hljs-selector-class">.pipe</span>(<span class="hljs-built_in">autoprefixer</span>(&#123;<br>          browsers: <span class="hljs-string">&#x27;last 2 versions&#x27;</span><br>        &#125;))<br>        <span class="hljs-selector-class">.pipe</span>(<span class="hljs-built_in">minifycss</span>())<br>        <span class="hljs-selector-class">.pipe</span>(sourcemaps<span class="hljs-selector-class">.write</span>(<span class="hljs-string">&#x27;./&#x27;</span>))<br>        <span class="hljs-selector-class">.pipe</span>(gulp<span class="hljs-selector-class">.dest</span>(<span class="hljs-string">&#x27;dist/css/&#x27;</span>))<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>在命令行输入 <code>gulp minifyss</code> 以压缩 <code>src/css/</code> 下的所有 .css 文件并复制到 <code>dist/css</code> 目录下</p>
<h3 id="7-7-配置-Less-任务"><a href="#7-7-配置-Less-任务" class="headerlink" title="7.7 配置 Less 任务"></a>7.7 配置 Less 任务</h3><hr>
<ul>
<li>参考配置 JavaScript 任务的方式配置 less 任务</li>
</ul>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">var</span> less = require(<span class="hljs-string">&#x27;gulp-less&#x27;</span>)<br><br>gulp.task(<span class="hljs-string">&#x27;watchless&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    gulp.watch(<span class="hljs-string">&#x27;src/less/**/*.less&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) &#123;<br>        <span class="hljs-keyword">var</span> paths = watchPath(event, <span class="hljs-string">&#x27;src/less/&#x27;</span>, <span class="hljs-string">&#x27;dist/css/&#x27;</span>)<br><br>		gutil.<span class="hljs-built_in">log</span>(gutil.colors.green(event.type) + <span class="hljs-string">&#x27; &#x27;</span> + paths.srcPath)<br>        gutil.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;Dist &#x27;</span> + paths.distPath)<br>        <span class="hljs-keyword">var</span> combined = combiner.obj([<br>            gulp.src(paths.srcPath),<br>            sourcemaps.init(),<br>            autoprefixer(&#123;<br>              <span class="hljs-attr">browsers</span>: <span class="hljs-string">&#x27;last 2 versions&#x27;</span><br>            &#125;),<br>            less(),<br>            minifycss(),<br>            sourcemaps.write(<span class="hljs-string">&#x27;./&#x27;</span>),<br>            gulp.dest(paths.distDir)<br>        ])<br>        combined.on(<span class="hljs-string">&#x27;error&#x27;</span>, handleError)<br>    &#125;)<br>&#125;)<br><br>gulp.task(<span class="hljs-string">&#x27;lesscss&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> combined = combiner.obj([<br>            gulp.src(<span class="hljs-string">&#x27;src/less/**/*.less&#x27;</span>),<br>            sourcemaps.init(),<br>            autoprefixer(&#123;<br>              <span class="hljs-attr">browsers</span>: <span class="hljs-string">&#x27;last 2 versions&#x27;</span><br>            &#125;),<br>            less(),<br>            minifycss(),<br>            sourcemaps.write(<span class="hljs-string">&#x27;./&#x27;</span>),<br>            gulp.dest(<span class="hljs-string">&#x27;dist/css/&#x27;</span>)<br>        ])<br>    combined.on(<span class="hljs-string">&#x27;error&#x27;</span>, handleError)<br>&#125;)<br><br>gulp.task(<span class="hljs-string">&#x27;default&#x27;</span>, [<span class="hljs-string">&#x27;watchjs&#x27;</span>, <span class="hljs-string">&#x27;watchcss&#x27;</span>, <span class="hljs-string">&#x27;watchless&#x27;</span>])<br></code></pre></td></tr></table></figure>

<h3 id="7-8-配置-Sass-任务"><a href="#7-8-配置-Sass-任务" class="headerlink" title="7.8 配置 Sass 任务"></a>7.8 配置 Sass 任务</h3><hr>
<p>参考配置 JavaScript 任务的方式配置 Sass 任务</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs lua">gulp.task(<span class="hljs-string">&#x27;watchsass&#x27;</span>,<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span></span> &#123;<br>    gulp.watch(<span class="hljs-string">&#x27;src/sass/**/*&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(event)</span></span> &#123;<br>        var paths = watchPath(event, <span class="hljs-string">&#x27;src/sass/&#x27;</span>, <span class="hljs-string">&#x27;dist/css/&#x27;</span>)<br><br>		gutil.<span class="hljs-built_in">log</span>(gutil.colors.green(event.<span class="hljs-built_in">type</span>) + <span class="hljs-string">&#x27; &#x27;</span> + paths.srcPath)<br>        gutil.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;Dist &#x27;</span> + paths.distPath)<br>        sass(paths.srcPath)<br>            .on(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(err)</span></span> &#123;<br>                console.<span class="hljs-built_in">error</span>(<span class="hljs-string">&#x27;Error!&#x27;</span>, err.message);<br>            &#125;)<br>            .pipe(sourcemaps.init())<br>            .pipe(minifycss())<br>            .pipe(autoprefixer(&#123;<br>              browsers: <span class="hljs-string">&#x27;last 2 versions&#x27;</span><br>            &#125;))<br>            .pipe(sourcemaps.<span class="hljs-built_in">write</span>(<span class="hljs-string">&#x27;./&#x27;</span>))<br>            .pipe(gulp.dest(paths.distDir))<br>    &#125;)<br>&#125;)<br><br>gulp.task(<span class="hljs-string">&#x27;sasscss&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span></span> &#123;<br>        sass(<span class="hljs-string">&#x27;src/sass/&#x27;</span>)<br>        .on(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(err)</span></span> &#123;<br>            console.<span class="hljs-built_in">error</span>(<span class="hljs-string">&#x27;Error!&#x27;</span>, err.message);<br>        &#125;)<br>        .pipe(sourcemaps.init())<br>        .pipe(minifycss())<br>        .pipe(autoprefixer(&#123;<br>          browsers: <span class="hljs-string">&#x27;last 2 versions&#x27;</span><br>        &#125;))<br>        .pipe(sourcemaps.<span class="hljs-built_in">write</span>(<span class="hljs-string">&#x27;./&#x27;</span>))<br>        .pipe(gulp.dest(<span class="hljs-string">&#x27;dist/css&#x27;</span>))<br>&#125;)<br><br>gulp.task(<span class="hljs-string">&#x27;default&#x27;</span>, [<span class="hljs-string">&#x27;watchjs&#x27;</span>, <span class="hljs-string">&#x27;watchcss&#x27;</span>, <span class="hljs-string">&#x27;watchless&#x27;</span>, <span class="hljs-string">&#x27;watchsass&#x27;</span>, <span class="hljs-string">&#x27;watchsass&#x27;</span>])<br></code></pre></td></tr></table></figure>

<h3 id="7-9-配置-image-任务"><a href="#7-9-配置-image-任务" class="headerlink" title="7.9 配置 image 任务"></a>7.9 配置 image 任务</h3><hr>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-tag">var</span> imagemin = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;gulp-imagemin&#x27;</span>)<br><br>gulp<span class="hljs-selector-class">.task</span>(<span class="hljs-string">&#x27;watchimage&#x27;</span>, function () &#123;<br>    gulp<span class="hljs-selector-class">.watch</span>(<span class="hljs-string">&#x27;src/images/**/*&#x27;</span>, function (event) &#123;<br>        <span class="hljs-selector-tag">var</span> paths = <span class="hljs-built_in">watchPath</span>(event,<span class="hljs-string">&#x27;src/&#x27;</span>,<span class="hljs-string">&#x27;dist/&#x27;</span>)<br><br>		gutil<span class="hljs-selector-class">.log</span>(gutil<span class="hljs-selector-class">.colors</span><span class="hljs-selector-class">.green</span>(event.type) + <span class="hljs-string">&#x27; &#x27;</span> + paths.srcPath)<br>        gutil<span class="hljs-selector-class">.log</span>(<span class="hljs-string">&#x27;Dist &#x27;</span> + paths.distPath)<br><br>        gulp<span class="hljs-selector-class">.src</span>(paths.srcPath)<br>            <span class="hljs-selector-class">.pipe</span>(<span class="hljs-built_in">imagemin</span>(&#123;<br>                progressive: true<br>            &#125;))<br>            <span class="hljs-selector-class">.pipe</span>(gulp<span class="hljs-selector-class">.dest</span>(paths.distDir))<br>    &#125;)<br>&#125;)<br><br>gulp<span class="hljs-selector-class">.task</span>(<span class="hljs-string">&#x27;image&#x27;</span>, function () &#123;<br>    gulp<span class="hljs-selector-class">.src</span>(<span class="hljs-string">&#x27;src/images/**/*&#x27;</span>)<br>        <span class="hljs-selector-class">.pipe</span>(<span class="hljs-built_in">imagemin</span>(&#123;<br>            progressive: true<br>        &#125;))<br>        <span class="hljs-selector-class">.pipe</span>(gulp<span class="hljs-selector-class">.dest</span>(<span class="hljs-string">&#x27;dist/images&#x27;</span>))<br>&#125;)<br></code></pre></td></tr></table></figure>

<h3 id="7-10-配置文件复制任务"><a href="#7-10-配置文件复制任务" class="headerlink" title="7.10 配置文件复制任务"></a>7.10 配置文件复制任务</h3><hr>
<p>复制 <code>src/fonts/</code> 文件到 <code>dist/</code> 中</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs stylus">gulp<span class="hljs-selector-class">.task</span>(<span class="hljs-string">&#x27;watchcopy&#x27;</span>, function () &#123;<br>    gulp<span class="hljs-selector-class">.watch</span>(<span class="hljs-string">&#x27;src/fonts/**/*&#x27;</span>, function (event) &#123;<br>        <span class="hljs-selector-tag">var</span> paths = <span class="hljs-built_in">watchPath</span>(event)<br><br>		gutil<span class="hljs-selector-class">.log</span>(gutil<span class="hljs-selector-class">.colors</span><span class="hljs-selector-class">.green</span>(event.type) + <span class="hljs-string">&#x27; &#x27;</span> + paths.srcPath)<br>        gutil<span class="hljs-selector-class">.log</span>(<span class="hljs-string">&#x27;Dist &#x27;</span> + paths.distPath)<br><br>        gulp<span class="hljs-selector-class">.src</span>(paths.srcPath)<br>            <span class="hljs-selector-class">.pipe</span>(gulp<span class="hljs-selector-class">.dest</span>(paths.distDir))<br>    &#125;)<br>&#125;)<br><br>gulp<span class="hljs-selector-class">.task</span>(<span class="hljs-string">&#x27;copy&#x27;</span>, function () &#123;<br>    gulp<span class="hljs-selector-class">.src</span>(<span class="hljs-string">&#x27;src/fonts/**/*&#x27;</span>)<br>        <span class="hljs-selector-class">.pipe</span>(gulp<span class="hljs-selector-class">.dest</span>(<span class="hljs-string">&#x27;dist/fonts/&#x27;</span>))<br>&#125;)<br><br>gulp<span class="hljs-selector-class">.task</span>(<span class="hljs-string">&#x27;default&#x27;</span>, <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;watchjs&#x27;</span>, <span class="hljs-string">&#x27;watchcss&#x27;</span>, <span class="hljs-string">&#x27;watchless&#x27;</span>, <span class="hljs-string">&#x27;watchsass&#x27;</span>, <span class="hljs-string">&#x27;watchimage&#x27;</span>, <span class="hljs-string">&#x27;watchcopy&#x27;</span>]</span>)<br></code></pre></td></tr></table></figure>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/" class="category-chain-item">前端工程化</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/glup/">#glup</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>glup总结</div>
      <div>http://example.com/2020/09/11/webpack/glup总结/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>John Doe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>September 11, 2020</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>Licensed under</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/09/17/webpack/webpack%20loader-plugin/" title="webpack loader-plugin">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">webpack loader-plugin</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/09/02/webpack/glup%E5%B7%A5%E4%BD%9C%E6%B5%81/" title="glup工作流">
                        <span class="hidden-mobile">glup工作流</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;Table of Contents</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
